<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2601 æ—¥æœ¬ä¹‹æ—… ğŸ‡¯ğŸ‡µ | Japan Trip 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Noto+Sans+TC:wght@400;700&display=swap"
        rel="stylesheet">
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #fdfdfe;
            --glass: rgba(255, 255, 255, 0.72);
            --glass-border: rgba(255, 255, 255, 0.5);
            --ios-blur: blur(20px) saturate(180%);
        }

        body {
            font-family: 'Outfit', 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
            background-image:
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.05) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(147, 51, 234, 0.05) 0px, transparent 50%);
            min-height: 100vh;
            padding-bottom: 6rem;
            padding-top: 90px;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: var(--ios-blur);
            -webkit-backdrop-filter: var(--ios-blur);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            box-shadow:
                0 4px 24px -1px rgba(0, 0, 0, 0.04),
                inset 0 0 0 1px rgba(255, 255, 255, 0.4);
        }

        /* Notion-inspired Card Style */
        .activity-card {
            background: white;
            border-radius: 18px;
            border: 1px solid #eef2f6;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.04);
            user-select: none;
            -webkit-user-select: none;
        }

        .activity-card.editing,
        .activity-card [contenteditable="true"] {
            user-select: text;
            -webkit-user-select: text;
        }

        .card-cover {
            width: 100%;
            height: 100px;
            background-size: cover;
            background-position: center;
            background-color: #f8fafc;
            position: relative;
        }

        .card-body {
            padding: 1rem 1.25rem 1.25rem 1.25rem;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .card-icon-floater {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-top: -30px;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 2px solid white;
        }

        .activity-card.cat-ç§»å‹• {
            border-left: 8px solid #3b82f6;
        }

        .activity-card.cat-æ™¯é» {
            border-left: 8px solid #10b981;
        }

        .activity-card.cat-åƒå– {
            border-left: 8px solid #f59e0b;
        }

        .activity-card.cat-ä½å®¿ {
            border-left: 8px solid #8b5cf6;
        }

        .activity-card.cat-è³¼ç‰© {
            border-left: 8px solid #ec4899;
        }

        .activity-card.cat-ä½œæ¥­ {
            border-left: 8px solid #64748b;
        }

        /* Category Header Accent */
        .card-cover.cat-accent {
            height: 60px;
            opacity: 0.15;
        }

        .cat-ç§»å‹• .card-cover.cat-accent {
            background-color: #3b82f6;
        }

        .cat-æ™¯é» .card-cover.cat-accent {
            background-color: #10b981;
        }

        .cat-åƒå– .card-cover.cat-accent {
            background-color: #f59e0b;
        }

        .cat-ä½å®¿ .card-cover.cat-accent {
            background-color: #8b5cf6;
        }

        .cat-è³¼ç‰© .card-cover.cat-accent {
            background-color: #ec4899;
        }

        .cat-ä½œæ¥­ .card-cover.cat-accent {
            background-color: #64748b;
        }

        .cat-badge {
            font-size: 9px;
            font-weight: 900;
            padding: 3px 8px;
            border-radius: 6px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .cat-ç§»å‹• .cat-badge {
            background: #3b82f6;
            color: white;
        }

        .cat-æ™¯é» .cat-badge {
            background: #10b981;
            color: white;
        }

        .cat-åƒå– .cat-badge {
            background: #f59e0b;
            color: white;
        }

        .cat-ä½å®¿ .cat-badge {
            background: #8b5cf6;
            color: white;
        }

        .cat-è³¼ç‰© .cat-badge {
            background: #ec4899;
            color: white;
        }

        .cat-ä½œæ¥­ .cat-badge {
            background: #64748b;
            color: white;
        }

        /* Gray-400 */

        /* Gray-200 */

        .icon-box {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
            transition: transform 0.2s;
        }

        .cat-ç§»å‹• .icon-box {
            background: #eff6ff;
            color: #3b82f6;
        }

        /* Blue */
        .cat-æ™¯é» .icon-box {
            background: #ecfdf5;
            color: #10b981;
        }

        /* Emerald */
        .cat-åƒå– .icon-box {
            background: #fffbeb;
            color: #f59e0b;
        }

        /* Amber */
        .cat-ä½å®¿ .icon-box {
            background: #f5f3ff;
            color: #8b5cf6;
        }

        /* Violet */
        .cat-è³¼ç‰© .icon-box {
            background: #fdf2f8;
            color: #ec4899;
        }

        /* Pink */
        .cat-ä½œæ¥­ .icon-box {
            background: #f3f4f6;
            color: #6b7280;
        }

        /* Gray */

        /* Google Maps Button */
        .map-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 9999px;
            color: #475569;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.2s;
            text-decoration: none;
            margin-top: 12px;
        }

        .map-btn:hover {
            background: #eff6ff;
            color: #2563eb;
            border-color: #bfdbfe;
            transform: translateY(-1px);
        }

        .card-detail {
            display: block;
            margin-top: 10px;
            padding-top: 0;
            /* Remove padding as it's cleaner without divider sometimes */
            border-top: none;
            /* Cleaner look */
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-btn {
            color: #94a3b8;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-btn.active {
            color: var(--primary);
            transform: translateY(-4px) scale(1.1);
            filter: drop-shadow(0 4px 8px rgba(37, 99, 235, 0.2));
        }

        .day-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .day-btn.active {
            background-color: var(--primary);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .strikethrough {
            text-decoration: line-through;
            opacity: 0.5;
            color: #94a3b8;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* Smart Header & Editable Styles */
        header {
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        body.header-hidden header {
            transform: translateY(-100%);
        }

        /* Day Selector Smart Positioning */
        #day-selector {
            position: sticky;
            top: 85px;
            /* Default below header */
            z-index: 30;
            transition: top 0.4s cubic-bezier(0.16, 1, 0.3, 1), background 0.3s;
            padding-top: 10px;
            padding-bottom: 10px;
            margin-bottom: 15px;
            border-bottom: 1px solid transparent;
            cursor: grab;
            /* Drag cursor */
            user-select: none;
            /* Prevent text selection */
        }

        #day-selector.active {
            cursor: grabbing;
            cursor: -webkit-grabbing;
        }

        /* Sticky Header Visibility */
        #day-selector {
            background: transparent;
            border-bottom: 0.5px solid transparent;
            box-shadow: none;
            transition: all 0.3s ease;
        }

        /* When header is hidden, move to absolute top for 'flush' feel */
        body.header-hidden #day-selector {
            top: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: var(--ios-blur);
            -webkit-backdrop-filter: var(--ios-blur);
            border-radius: 0;
            margin-left: -1rem;
            margin-right: -1rem;
            padding-left: 1.5rem;
            padding-right: 1.5rem;
            border-bottom: 0.5px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
            z-index: 900;
            /* Below main header but above cards */
        }

        /* Editing Mode - Premium Style */
        [contenteditable]:focus {
            outline: none;
        }

        .activity-card.editing {
            background: #ffffff;
            box-shadow: 0 0 0 2px #3b82f6, 0 12px 24px -6px rgba(59, 130, 246, 0.25);
            transform: translateY(-2px);
            z-index: 20;
        }

        /* Input Fields */
        .editable-field[contenteditable="true"] {
            transition: all 0.2s ease;
            border-radius: 6px;
            padding: 2px 6px;
            margin: 0 -6px;
            /* Touch area expansion */
            border: 1px solid transparent;
        }

        .editable-field[contenteditable="true"]:hover {
            background: #f1f5f9;
        }

        .editable-field[contenteditable="true"]:focus {
            background: #fff;
            box-shadow: 0 0 0 2px #bfdbfe;
            border-color: #3b82f6;
            color: #1e293b;
        }

        /* Detail Modal Editing Cues */
        #detail-modal [contenteditable="true"] {
            padding: 4px 8px;
            margin: 0 -8px;
            border-radius: 8px;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        #detail-modal [contenteditable="true"]:hover {
            background: #f8fafc;
            border-color: #e2e8f0;
        }

        #detail-modal [contenteditable="true"]:focus {
            background: #fff;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .editing-label {
            display: none;
            font-size: 10px;
            color: #3b82f6;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 4px;
        }

        #detail-modal [contenteditable="true"]:focus+.editing-label,
        #detail-modal [contenteditable="true"]:hover+.editing-label {
            display: block;
        }

        @keyframes bounce-gentle {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-3px);
            }
        }

        /* Action Buttons - Always Visible */
        .card-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 10px;
            z-index: 50;
            pointer-events: auto;
            transition: opacity 0.2s;
        }

        .activity-card.editing .card-actions {
            opacity: 0;
            pointer-events: none;
        }

        /* Drag Handle */
        .activity-card.dragging {
            opacity: 0.5;
            z-index: 1000 !important;
            background: #f8fafc;
            border: 2px dashed #3b82f6;
            transform: scale(1.05);
            /* Noticeable lift */
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            /* Add subtle shadow */
        }

        .edit-btn {
            background: #f1f5f9;
            color: #64748b;
        }

        .edit-btn:hover {
            background: #dbeafe;
            color: #3b82f6;
        }

        .delete-btn-static {
            background: #fef2f2;
            color: #ef4444;
        }

        .delete-btn-static:hover {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Editing State for Card */
        /* .activity-card.editing {
            box-shadow: 0 0 0 2px #3b82f6;
            background: #eff6ff;
        } */

        .activity-card.editing .card-actions {
            display: none;
        }

        /* Hide edit/del buttons */

        .done-btn {
            display: none;
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 6px 16px;
            background: #3b82f6;
            color: white;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3);
            cursor: pointer;
            z-index: 100;
        }

        .done-btn:hover {
            background: #2563eb;
        }

        .activity-card.editing .done-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-header-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: -38px;
            z-index: 20;
            position: relative;
        }

        .card-header-group.no-cover {
            margin-top: 0;
            margin-bottom: 8px;
        }

        /* Animation for clickable elements in edit mode */
        .hover-pulse {
            animation: pulse 2s infinite;
            cursor: pointer;
        }

        @keyframes pulse {
            0% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }

            100% {
                opacity: 1;
            }
        }

        /* Floating Add Button */
        #fab-add {
            position: fixed;
            bottom: 100px;
            right: 24px;
            width: 56px;
            height: 56px;
            background: var(--primary);
            color: white;
            border-radius: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4);
            z-index: 100;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: none;
            cursor: pointer;
        }

        #fab-add:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 12px 32px rgba(37, 99, 235, 0.5);
        }

        #fab-add:active {
            transform: scale(0.95);
        }

        .tab-content:not(.active)~#fab-add,
        #todo.active~#fab-add,
        #vouchers.active~#fab-add {
            display: none;
        }

        /* Packing List Styles */
        .packing-category {
            background: white;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .packing-item {
            transition: all 0.2s;
        }

        .packing-item.checked {
            background: #f8fafc;
        }

        .packing-item.checked span {
            text-decoration: line-through;
            opacity: 0.5;
        }

        /* Voucher Styles */
        .voucher-card {
            background: white;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            overflow: hidden;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .voucher-card:active {
            transform: scale(0.98);
        }

        .voucher-img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: #f1f5f9;
        }

        .voucher-overlay {
            position: fixed;
            inset: 0;
            z-index: 3000;
            background: rgba(15, 23, 42, 0.95);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .voucher-overlay.show {
            display: flex;
        }

        /* Only show FAB when Itinerary tab is active and modal is CLOSED */
        body:has(#itinerary.active) #fab-add {
            display: flex;
        }

        body.modal-open #fab-add {
            display: none !important;
        }

        body:has(#detail-modal.show) #fab-add {
            display: none !important;
        }

        /* Fallback for browsers that don't support :has */
        .fab-hidden {
            display: none !important;
        }

        #custom-modal {
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        #custom-modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        #custom-modal .modal-card {
            transform: scale(0.95);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        #custom-modal.show .modal-card {
            transform: scale(1);
        }

        /* Cloud Sync UI Styles */
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e1;
            display: inline-block;
            margin-right: 4px;
        }

        .sync-indicator.online {
            background: #22c55e;
            box-shadow: 0 0 8px #22c55e;
        }

        .sync-indicator.syncing {
            background: #3b82f6;
            animation: pulse 1s infinite;
        }

        /* Modern Bubble Editor Toolbar */
        /* Modern Selection Toolbar */
        .rich-toolbar {
            position: fixed;
            background: #1e293b;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 6px;
            display: flex;
            gap: 4px;
            z-index: 3000;
            box-shadow:
                0 10px 15px -3px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(0, 0, 0, 0.1);
            opacity: 0;
            pointer-events: none;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateY(8px) scale(0.95);
        }

        .rich-toolbar.show {
            opacity: 1;
            pointer-events: auto;
            transform: translateY(0) scale(1);
        }

        .rich-toolbar::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 6px solid rgba(30, 41, 59, 0.95);
        }

        .toolbar-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .toolbar-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-color: rgba(255, 255, 255, 0.1);
        }

        .toolbar-btn.active {
            background: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .toolbar-color {
            width: 14px;
            height: 14px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .toolbar-divider {
            width: 1px;
            height: 20px;
            background: rgba(255, 255, 255, 0.15);
            margin: 0 4px;
            align-self: center;
        }
    </style>
</head>

<body class="text-slate-800">

    <!-- Detail Modal (New) -->
    <div id="detail-modal"
        class="fixed inset-0 z-[2000] flex items-end sm:items-center justify-center pointer-events-none opacity-0 transition-opacity duration-300">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onclick="closeDetailModal()"></div>
        <div
            class="detail-card bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl p-0 relative shadow-2xl max-h-[90vh] overflow-y-auto transform translate-y-full transition-transform duration-300 ease-out flex flex-col">

            <!-- Cover Image Area -->
            <div id="detail-img-container" class="w-full h-48 bg-slate-100 relative group/cover">
                <img id="detail-img" src="" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                <label
                    class="absolute top-4 right-4 bg-black/50 backdrop-blur text-white p-2 rounded-full cursor-pointer hover:bg-black/70 transition opacity-0 group-hover/cover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                    </svg>
                    <input type="file" class="hidden" onchange="handleDetailImageUpload(this)">
                </label>
            </div>

            <div class="p-6 relative">
                <!-- Header -->
                <div class="flex items-start gap-4 mb-4">
                    <div id="detail-icon" class="text-4xl filter drop-shadow-md"></div>
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <span id="detail-cat"
                                class="text-xs px-2 py-0.5 rounded-full bg-slate-100 font-bold text-slate-600"></span>
                            <span id="detail-time" class="text-xs text-slate-400 font-mono"></span>
                        </div>
                        <h2 id="detail-title" class="text-2xl font-black text-slate-800 leading-tight outline-none"
                            contenteditable="true"></h2>
                    </div>
                </div>

                <!-- Body -->
                <div id="detail-desc" class="text-base text-slate-600 leading-7 mb-8 rich-content outline-none"
                    contenteditable="true"></div>

                <!-- Actions -->
                <div class="flex flex-col gap-3 mt-4 border-t border-slate-50 pt-6">
                    <a id="detail-map" href="#" target="_blank"
                        class="flex items-center justify-center gap-2 w-full py-3 bg-blue-50 text-blue-600 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-blue-100 transition hidden">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"
                                clip-rule="evenodd" />
                        </svg>
                        é–‹å•Ÿ Google Maps
                    </a>

                    <div class="flex gap-3">
                        <button onclick="saveDetailModal()"
                            class="flex-[2] py-3.5 bg-blue-500 text-white rounded-xl text-sm font-black uppercase tracking-wider shadow-lg shadow-blue-500/30 hover:bg-blue-600 transition-all active:scale-95">å„²å­˜è®Šæ›´</button>
                        <button onclick="closeDetailModal()"
                            class="flex-1 py-3.5 bg-slate-100 text-slate-500 rounded-xl text-sm font-black uppercase tracking-wider hover:bg-slate-200 transition-all">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        #detail-modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        #detail-modal.show .detail-card {
            transform: translateY(0);
        }

        /* Rich Content Styles */
        .rich-content img {
            border-radius: 12px;
            margin: 12px 0;
            max-width: 100%;
            height: auto;
            border: 1px solid #f1f5f9;
        }

        .rich-content b {
            font-weight: 800;
            color: #0f172a;
        }

        .rich-content i {
            font-style: italic;
            opacity: 0.9;
        }

        .rich-content .highlight {
            padding: 0 4px;
            border-radius: 4px;
        }
    </style>

    <!-- Custom Modal -->
    <div id="custom-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm" onclick="closeModal()"></div>
        <div
            class="modal-card glass-card bg-white/95 p-6 w-full max-w-xs relative z-10 text-center shadow-2xl border-white/50">
            <div
                class="w-12 h-12 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold">
                !</div>
            <h3 class="text-lg font-black mb-2 text-slate-800">ç¢ºèªæ“ä½œ</h3>
            <p id="modal-msg" class="text-sm text-slate-500 mb-6 font-bold leading-relaxed"></p>
            <div class="flex gap-3 justify-center">
                <button onclick="closeModal()"
                    class="flex-1 px-4 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold hover:bg-slate-200 transition-colors text-sm">å–æ¶ˆ</button>
                <button id="modal-confirm-btn"
                    class="flex-1 px-4 py-3 rounded-xl bg-blue-500 text-white font-bold hover:bg-blue-600 shadow-lg shadow-blue-500/30 transition-all text-sm">ç¢ºå®š</button>
            </div>
        </div>
    </div>

    <!-- Sticky Header -->
    <header id="main-header"
        class="fixed top-0 left-0 right-0 z-[1000] bg-white/70 backdrop-blur-2xl border-b-[0.5px] border-black/5 px-6 py-4"
        style="backdrop-filter: var(--ios-blur); -webkit-backdrop-filter: var(--ios-blur);">
        <div class="max-w-md mx-auto flex justify-between items-center">
            <div>
                <h1 class="text-xl font-bold tracking-tight">2601 æ—¥æœ¬ä¹‹æ—… ğŸ‡¯ğŸ‡µ</h1>
                <p class="text-[10px] text-slate-500 font-semibold uppercase tracking-widest leading-none mt-1">Winter
                    Expedition 2026</p>
            </div>
            <div class="text-right flex items-center gap-3">
                <div class="relative group cursor-default">
                    <div id="cloud-status-dot" class="sync-indicator"></div>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-5 h-5 text-slate-300">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" />
                    </svg>
                    <!-- Tooltip for status -->
                    <div
                        class="absolute right-0 top-full mt-2 w-max px-2 py-1 bg-slate-800 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">
                        é›²ç«¯åŒæ­¥ä¸­
                    </div>
                </div>
                <button onclick="resetData()"
                    class="text-[10px] text-slate-400 font-bold hover:text-red-500 transition-colors">é‡ç½®</button>
                <span
                    class="text-[10px] font-black text-blue-600 bg-blue-50 px-2 py-1 rounded-full border border-blue-100 italic">10
                    DAYS</span>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto px-4 py-6">

        <!-- Main Tab: Itinerary -->
        <div id="itinerary" class="tab-content active space-y-6">

            <!-- Horizontal Day Selector -->
            <div class="flex overflow-x-auto gap-3 pb-4 no-scrollbar -mx-4 px-4 sticky top-[72px] z-30 transition-all duration-300"
                id="day-selector">
                <button onclick="switchDay(1)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center active"
                    data-day="1">
                    <span class="text-[8px] font-bold uppercase opacity-60">Jan</span>
                    <span class="text-lg font-black leading-none">27</span>
                </button>
                <button onclick="switchDay(2)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="2">
                    <span class="text-[8px] font-bold uppercase opacity-60">Jan</span>
                    <span class="text-lg font-black leading-none">28</span>
                </button>
                <button onclick="switchDay(3)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="3">
                    <span class="text-[8px] font-bold uppercase opacity-60">Jan</span>
                    <span class="text-lg font-black leading-none">29</span>
                </button>
                <button onclick="switchDay(4)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="4">
                    <span class="text-[8px] font-bold uppercase opacity-60">Jan</span>
                    <span class="text-lg font-black leading-none">30</span>
                </button>
                <button onclick="switchDay(5)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="5">
                    <span class="text-[8px] font-bold uppercase opacity-60">Jan</span>
                    <span class="text-lg font-black leading-none">31</span>
                </button>
                <button onclick="switchDay(6)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="6">
                    <span class="text-[8px] font-bold uppercase opacity-60">Feb</span>
                    <span class="text-lg font-black leading-none">01</span>
                </button>
                <button onclick="switchDay(7)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="7">
                    <span class="text-[8px] font-bold uppercase opacity-60">Feb</span>
                    <span class="text-lg font-black leading-none">02</span>
                </button>
                <button onclick="switchDay(8)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="8">
                    <span class="text-[8px] font-bold uppercase opacity-60">Feb</span>
                    <span class="text-lg font-black leading-none">03</span>
                </button>
                <button onclick="switchDay(9)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="9">
                    <span class="text-[8px] font-bold uppercase opacity-60">Feb</span>
                    <span class="text-lg font-black leading-none">04</span>
                </button>
                <button onclick="switchDay(10)"
                    class="day-btn flex-none w-14 h-14 glass-card flex flex-col items-center justify-center"
                    data-day="10">
                    <span class="text-[8px] font-bold uppercase opacity-60">Feb</span>
                    <span class="text-lg font-black leading-none">05</span>
                </button>
            </div>

            <!-- Day Container -->
            <div id="day-container" class="space-y-3"></div>
        </div>

        <!-- Floating Add Button -->
        <button id="fab-add" onclick="addNewCard()" title="æ–°å¢è¡Œç¨‹">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5"
                stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
        </button>

        <!-- Tab: Shopping -->
        <div id="shopping" class="tab-content space-y-6">
            <!-- Rendered by JS -->
        </div>

        <!-- Tab: Packing -->
        <div id="packing" class="tab-content space-y-4">
            <!-- Rendered by JS -->
        </div>

        <!-- Tab: To-Do -->
        <div id="todo" class="tab-content space-y-4">
            <!-- Rendered by JS -->
        </div>

        <!-- Tab: Vouchers -->
        <div id="vouchers" class="tab-content space-y-4">
            <!-- Rendered by JS -->
        </div>

        <!-- Modern Rich Text Toolbar -->
        <div id="rich-toolbar" class="rich-toolbar">
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="richCmd('bold')" title="ç²—é«”">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" />
                    <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z" />
                </svg>
            </button>
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="richCmd('italic')" title="æ–œé«”">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="4" x2="10" y2="4" />
                    <line x1="14" y1="20" x2="5" y2="20" />
                    <line x1="15" y1="4" x2="9" y2="20" />
                </svg>
            </button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="richCmd('foreColor', '#ee4444')"
                title="ç´…å­—">
                <div class="toolbar-color bg-red-500"></div>
            </button>
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="richCmd('foreColor', '#3b82f6')"
                title="è—å­—">
                <div class="toolbar-color bg-blue-500"></div>
            </button>
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="richCmd('foreColor', '#fbbf24')"
                title="é»ƒå­—">
                <div class="toolbar-color bg-amber-400"></div>
            </button>
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="richCmd('hiliteColor', '#fcd34d')"
                title="è¢å…‰ç­†">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m9 11-6 6v3h9l3-3" />
                    <path d="m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4" />
                </svg>
            </button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="richCmd('insertUnorderedList')"
                title="åˆ—è¡¨">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="8" y1="6" x2="21" y2="6" />
                    <line x1="8" y1="12" x2="21" y2="12" />
                    <line x1="8" y1="18" x2="21" y2="18" />
                    <line x1="3" y1="6" x2="3.01" y2="6" />
                    <line x1="3" y1="12" x2="3.01" y2="12" />
                    <line x1="3" y1="18" x2="3.01" y2="18" />
                </svg>
            </button>
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="promptInsertImage()" title="åœ–ç‰‡">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                    <circle cx="8.5" cy="8.5" r="1.5" />
                    <polyline points="21 15 16 10 5 21" />
                </svg>
            </button>
            <div class="toolbar-divider"></div>
            <button class="toolbar-btn" onmousedown="event.preventDefault()" onclick="richCmd('removeFormat')"
                title="æ¸…é™¤æ ¼å¼">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17.47 17.47 15.3 15.3M12.8 12.8 5 5" />
                    <path d="m11 5 8 8" />
                    <path d="m14 19-3-3" />
                    <path d="M17.9 17.9 20 20" />
                    <path d="M4.1 4.1 2 2" />
                </svg>
            </button>
        </div>

    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 p-4 z-50">
        <div class="max-w-md mx-auto glass-card flex justify-around items-center px-4 py-3">
            <button onclick="changeTab('itinerary')" class="nav-btn flex flex-col items-center gap-1 active"
                data-tab="itinerary">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                </svg>
                <span class="text-[9px] font-black uppercase tracking-tighter">è¡Œç¨‹</span>
            </button>
            <button onclick="changeTab('shopping')" class="nav-btn flex flex-col items-center gap-1"
                data-tab="shopping">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M15.75 10.5V6a3.75 3.75 0 10-7.5 0v4.5m11.356-1.993l1.263 12c.07.665-.45 1.243-1.119 1.243H4.25a1.125 1.125 0 01-1.12-1.243l1.264-12A1.125 1.125 0 015.513 7.5h12.974c.576 0 1.059.435 1.119 1.007zM8.625 10.5a.375.375 0 11-.75 0 .375.375 0 01.75 0zm7.5 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                </svg>
                <span class="text-[9px] font-black uppercase tracking-tighter">è³¼ç‰©</span>
            </button>
            <button onclick="changeTab('packing')" class="nav-btn flex flex-col items-center gap-1" data-tab="packing">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M20.25 14.15v4.25c0 1.094-.787 2.036-1.872 2.18-2.087.277-4.216.42-6.378.42s-4.291-.143-6.378-.42c-1.085-.144-1.872-1.086-1.872-2.18v-4.25m16.5 0a2.18 2.18 0 00.75-1.661V8.706c0-1.081-.768-2.015-1.837-2.175a48.114 48.114 0 00-3.413-.387m4.5 8.006c-.194.165-.42.295-.673.38A23.978 23.978 0 0112 15.75c-2.648 0-5.195-.429-7.577-1.22a2.016 2.016 0 01-.673-.38m0 0A2.18 2.18 0 013 12.489V8.706c0-1.081.768-2.015 1.837-2.175 4.835-.729 9.945-.9 15.326 0-1.07.16-1.837 1.094-1.837 2.175v3.783a2.18 2.18 0 01-.75 1.661M9 20.25v-1.5m6 1.5v-1.5m-9-15.75h12m-12 0L6 3m12 1.5L15 3" />
                </svg>
                <span class="text-[9px] font-black uppercase tracking-tighter">è¡Œæ</span>
            </button>
            <button onclick="changeTab('todo')" class="nav-btn flex flex-col items-center gap-1" data-tab="todo">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span class="text-[9px] font-black uppercase tracking-tighter">å¾…è¾¦</span>
            </button>
            <button onclick="changeTab('vouchers')" class="nav-btn flex flex-col items-center gap-1"
                data-tab="vouchers">
                <span class="text-xl">ğŸŸï¸</span>
                <span class="text-[9px] font-black uppercase tracking-tighter">å„ªæƒ </span>
            </button>
        </div>
    </nav>

    <script>
        // Strictly verified itinerary data (Default) - Updated from Notion Database
        const defaultItinerary = {
            "1": [
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "å®¶ â†’ æ¡ƒåœ’æ©Ÿå ´",
                                    "time": "09:03",
                                    "desc": "Daryl: 09:03æ­ç’°ç‹€ç·š          - 09:25 æ–°åŒ—ç”¢æ¥­ æ­æ©Ÿæ· Joseph: 09:26 æ­æ©Ÿæ· 09:50 Check in",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å®¶ â†’ æ¡ƒåœ’æ©Ÿå ´"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "æ–°ä¸¸ä¹‹å…§å¤§å»ˆ",
                                    "time": "11:00",
                                    "desc": "7Få…è²»è§€æ™¯å° çœ‹æ±äº¬è»Šç«™ 11:00â€“23:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ–°ä¸¸ä¹‹å…§å¤§å»ˆ"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "èˆªç­ CX450",
                                    "time": "12:50",
                                    "desc": "12:50 æ¡ƒåœ’ç¬¬ä¸€èˆªå»ˆ 16:50 æˆç”° ğŸ‡¯ğŸ‡µç¬¬äºŒèˆªå»ˆ",
                                    "map": "https://www.google.com/maps/search/?api=1&query=èˆªç­ CX450"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "ä¸¸ä¹‹å…§2025ç‡ˆå…‰ç§€",
                                    "time": "16:00",
                                    "desc": "2025å¹´11æœˆ13æ—¥è‡³2026å¹´2æœˆ15æ—¥ 16:00ï½23:00 https://www.facebook.com/travelyam/posts/2025%E4%B8%B8%E4%B9%8B%E5%85%A7%E9%BB%9E%E7%87%881113%E7%99%BB%E5%A0%B4%E8%BF%AA%E5%A3%AB%E5%B0%BC%E7%87%88%E6%B5%B7%E5%A4%A2%E5%B9%BB%E7%8F%BE%E8%BA%AB%E4%B8%B8%E4%B9%8B%E5%85%A7%E9%BB%9E%E7%87%882025%E5%B0%87%E6%96%BC1113%E8%87%B32026215%E6%96%BC%E6%9D%B1%E4%BA%AC%E8%BB%8A%E7%AB%99%E9%99%84%E8%BF%91%E8%88%89%E8%BE%A6%E6%98%AF%E6%AF%8F%E9%80%A2%E5%86%AC%E5%AD%A3%E5%BF%85%E7%9C%8B%E8%81%96%E8%AA%95%E7%87%88%E9%A3%BE%E4%B9%8B%E4%B8%80%E9%80%99%E6%A2%9D%E9%95%B7%E9%81%9412km%E7%9A%84%E4%B8%B8%E4%B9%8B/1122895263345279/",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ä¸¸ä¹‹å…§2025ç‡ˆå…‰ç§€",
                                    "img": "New Database/%E4%B8%B8%E4%B9%8B%E5%85%A72025%E7%87%88%E5%85%89%E7%A7%80/2025xmastokyo7-1600x1067-1759821075.webp"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "Skylinerï¼š49åˆ†",
                                    "time": "17:59",
                                    "desc": "17:59 - 18:48 åˆ°ä¸Šé‡ https://maps.app.goo.gl/hgRFVN6Kz1WR2yLe8 è½‰å±±æ‰‹ç·šåˆ°ç¥ç”°ç«™ (20min) https://www.keisei.co.jp/keisei/tetudou/skyliner/tc/traffic/skyliner.php",
                                    "map": "https://maps.app.goo.gl/hgRFVN6Kz1WR2yLe8"
                        },
                        {
                                    "cat": "ä½å®¿",
                                    "icon": "ğŸ›ŒğŸ»",
                                    "title": "ãƒ›ãƒ†ãƒ«SUIç¥ç”° by ABEST",
                                    "time": "19:00",
                                    "desc": "é è¨ˆ 19:00 Check in https://mypage.travel.rakuten.co.jp/?l-id=mypage_submenu&",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ãƒ›ãƒ†ãƒ«SUIç¥ç”° by ABEST"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ™šé¤ - æ²¾éºµ å…­å˜èˆ æ±äº¬ç«™åº—",
                                    "time": "23:00",
                                    "desc": "23:00æ‰“çƒŠ / ç„¡å…¬ä¼‘ã€ç„¡æ³•é ç´„",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ™šé¤ - æ²¾éºµ å…­å˜èˆ æ±äº¬ç«™åº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "è¶…å•† åƒå®µå¤œ or è—¥å¦å”å‰è¨¶å¾·",
                                    "time": "",
                                    "desc": "è¨˜å¾—å»7-11æ›Gagaæ¼”å”±æœƒç¥¨ (https://hochehao.com/lady-gaga-japan-tour-2026-tickets-receive/#penci-%F0%9F%AA%A7_%E9%A0%98%E7%A5%A8%E6%96%B9%E5%BC%8F) - å”å‰è¨¶å¾· ç§‹è‘‰åŸåº—(https://maps.app.goo.gl/ZhQMDSWdjHatMTfZ8) è²·å®šå‹å™´éœ§ã€å®šå¦ã€è¥ªå­ã€è­·æ‰‹éœœ(Kose coen rich Q10)ã€è­·å”‡è†ã€é…¸ç—›è—¥å¸ƒã€æš–æš–åŒ…(è²¼å¼)",
                                    "map": "https://maps.app.goo.gl/ZhQMDSWdjHatMTfZ8"
                        },
                        {
                                    "cat": "ä½œæ¥­",
                                    "icon": "ğŸ“‹",
                                    "title": "æ±äº¬æµ·ä¸Šæ—¥å‹•æ—…å¹³éšª",
                                    "time": "",
                                    "desc": "åˆ°äº†å¢ƒå…§æ‰å¯ä»¥ä¿ VJWå…§",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ±äº¬æµ·ä¸Šæ—¥å‹•æ—…å¹³éšª"
                        },
                        {
                                    "cat": "ä½œæ¥­",
                                    "icon": "ğŸ“‹",
                                    "title": "å–æ–°å¹¹ç·šç¥¨",
                                    "time": "",
                                    "desc": "QRCodeåœ¨å…§é ",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å–æ–°å¹¹ç·šç¥¨"
                        }
            ],
            "2": [
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ—©é¤ - ç¹é‚¦",
                                    "time": "09:00",
                                    "desc": "æƒ æ¯”å£½é§… 09:00â€“15:00 17:30â€“23:00 æ—©é¤æ™‚æ®µç„¡æ³•é ç´„",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ—©é¤ - ç¹é‚¦",
                                    "img": "New Database/%E6%97%A9%E9%A4%90 - %E7%B9%81%E9%82%A6/%E6%88%AA%E5%9C%96_2025-10-24_20.54.12.png"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "THE ROASTERY by NOZY COFFEE",
                                    "time": "10:00",
                                    "desc": "10:00â€“20:00 ç„¡å…¬ä¼‘ å¸Œæœ›å¯ä»¥å…§ç”¨ğŸ¥ºä½†è¶•æ™‚é–“å¤–å¸¶ä¹Ÿæ²’é—œä¿‚Â by Jo",
                                    "map": "https://www.google.com/maps/search/?api=1&query=THE ROASTERY by NOZY COFFEE"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Beams Life æ¨ªæµœ",
                                    "time": "10:00",
                                    "desc": "10:00â€“21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Beams Life æ¨ªæµœ"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "BIC Camera",
                                    "time": "10:00",
                                    "desc": "å¯èƒ½æ”¹ä»™å°å›ä¾†åœ¨è²·(å›é¥‹10%) 10:00-22:00 https://maps.app.goo.gl/f9ASWeuowqQREJLt6",
                                    "map": "https://maps.app.goo.gl/f9ASWeuowqQREJLt6"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "SUGAR BUTTER TREE Sogoæ©«æ¿±",
                                    "time": "10:00",
                                    "desc": "10:00â€“20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=SUGAR BUTTER TREE Sogoæ©«æ¿±"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "æƒ æ¯”å£½ â†’ æ¨ªæµœ",
                                    "time": "10:09",
                                    "desc": "JRæ¹˜å—æ–°å®¿ãƒ©ã‚¤ãƒ³å¿«é€Ÿ 10:09â†’10:32 10:23â†’10:49",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æƒ æ¯”å£½ â†’ æ¨ªæµœ"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "3COINS åŸå®¿æ——è‰¦åº—",
                                    "time": "11:00",
                                    "desc": "11:00â€“20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=3COINS åŸå®¿æ——è‰¦åº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "On æ±äº¬æ——è‰¦åº—",
                                    "time": "11:00",
                                    "desc": "11:00â€“20:00 è¦æ’éšŠå°±æ”¾æ£„",
                                    "map": "https://www.google.com/maps/search/?api=1&query=On æ±äº¬æ——è‰¦åº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Adam et Rope PARCO",
                                    "time": "11:00",
                                    "desc": "PARCO Shibuya 4F 11:00â€“21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Adam et Rope PARCO"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "HOKA Shibuya æ——è‰¦åº—",
                                    "time": "11:00",
                                    "desc": "11:00-20:00 2F æ‰€æœ‰é‹æ¬¾&è¡£æœ 3F HOKA Run Club https://www.threads.com/@luke.thereal4sho/post/DAaAJDHBegR?hl=zh-tw",
                                    "map": "https://www.google.com/maps/search/?api=1&query=HOKA Shibuya æ——è‰¦åº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Diptyque é’å±±",
                                    "time": "11:00",
                                    "desc": "11:00â€“20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Diptyque é’å±±"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "BILLYâ€™S ENT Shibuya",
                                    "time": "11:00",
                                    "desc": "11:00-20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=BILLYâ€™S ENT Shibuya"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "ATMOS Shibuya",
                                    "time": "11:00",
                                    "desc": "11:00-21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ATMOS Shibuya"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "BASO è¡¨å‚é“ é´¨è‚‰è•éº¥éºµ",
                                    "time": "11:30",
                                    "desc": "11:30â€“21:00 é´¨è‚‰è•éº¥éºµ (å¯èŠ±éŒ¢å¿«é€Ÿé€šé—œ)",
                                    "map": "https://www.google.com/maps/search/?api=1&query=BASO è¡¨å‚é“ é´¨è‚‰è•éº¥éºµ"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "Kenyan Shibuya",
                                    "time": "11:30",
                                    "desc": "11:30â€“22:00 å¤–å¸¶",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Kenyan Shibuya"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Graphpaper é’å±±åº—",
                                    "time": "12:00",
                                    "desc": "12:00â€“19:00 ä¸€ä¼‘",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Graphpaper é’å±±åº—",
                                    "img": "New Database/Graphpaper %E9%9D%92%E5%B1%B1%E5%BA%97/download.jpg"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "FREAK'S STORE æ¶‰è°·",
                                    "time": "12:00",
                                    "desc": "12:00â€“20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=FREAK'S STORE æ¶‰è°·"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ™šé¤ - çƒé¾éºµå±±é•· æƒ æ¯”å£½åº—",
                                    "time": "12:00",
                                    "desc": "å‚™æ¡ˆ 12:00â€“15:30 17:00â€“22:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ™šé¤ - çƒé¾éºµå±±é•· æƒ æ¯”å£½åº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "H BEAUTY&YOUTH",
                                    "time": "12:00",
                                    "desc": "12:00â€“20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=H BEAUTY&YOUTH"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "æ¨ªæµœ â†’ è¡¨åƒé“",
                                    "time": "12:03",
                                    "desc": "12:03â†’12:43 12:12â†’12:50 12:18â†’12:53  éƒ½è¦æ›ä¸€ç­è»Š",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ¨ªæµœ â†’ è¡¨åƒé“"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "å…­æœ¬æœ¨Keyakizakaå‚é€š",
                                    "time": "17:00",
                                    "desc": "-2/14 17:00-23:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å…­æœ¬æœ¨Keyakizakaå‚é€š",
                                    "img": "New Database/%E5%85%AD%E6%9C%AC%E6%9C%A8Keyakizaka%E5%9D%82%E9%80%9A/Screenshot_2025-12-29_141114.png"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ™šé¤ - æ´»ç¾ç™»åˆ©",
                                    "time": "19:00",
                                    "desc": "æœ€å¥½19:00å‰æŠ½ æ’ä¸åˆ°å°±æ®ºå»æƒ æ¯”å£½åƒçƒé¾éºµ",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ™šé¤ - æ´»ç¾ç™»åˆ©"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "Streamer Coffee Company Shibuya",
                                    "time": "20:00",
                                    "desc": "ç„¡å…¬ä¼‘ ç‡Ÿæ¥­æ™‚é–“åˆ°20:00 å¯å¤–å¸¶",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Streamer Coffee Company Shibuya"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "UNITED TOKYO ç¥å®®å‰",
                                    "time": "",
                                    "desc": "",
                                    "map": "https://www.google.com/maps/search/?api=1&query=UNITED TOKYO ç¥å®®å‰"
                        }
            ],
            "3": [
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "æ±äº¬å¤§ç¥å®®",
                                    "time": "06:00",
                                    "desc": "06:00â€“21:00 æœ‰æ™‚é–“å°±å»",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ±äº¬å¤§ç¥å®®"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "ç¥ç”° â†’ äº¬æ©‹",
                                    "time": "07:02",
                                    "desc": "07:02â†’07:07 (5mins) 07:05â†’07:10 07:08â†’07:14",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ç¥ç”° â†’ äº¬æ©‹"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "äº¬æ©‹ â†’ ç¥è°·ç”º",
                                    "time": "07:42",
                                    "desc": "07:42â†’07:57 (15mins) 07:48â†’08:02 07:57â†’08:12  éŠ€åº§ç·š â†’éŠ€åº§ç«™ æ›æ—¥æ¯”è°·ç·š",
                                    "map": "https://www.google.com/maps/search/?api=1&query=äº¬æ©‹ â†’ ç¥è°·ç”º"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "08:00 Balcony by 6th",
                                    "time": "08:00",
                                    "desc": "08:00â€“10:30 11:00â€“23:00 Tabelog å·²è¨‚ä½",
                                    "map": "https://www.google.com/maps/search/?api=1&query=08:00 Balcony by 6th"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "neel ä¸­ç›®é»‘",
                                    "time": "09:00",
                                    "desc": "09:00â€“20:30 æˆ–æ˜¯å–SIDEWALK STAND",
                                    "map": "https://www.google.com/maps/search/?api=1&query=neel ä¸­ç›®é»‘"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "teamLab Borderless éº»å¸ƒå°",
                                    "time": "09:00",
                                    "desc": "09:00â€“21:00 https://www.klook.com/zh-TW/activity/20707-teamlab-borderless-admission-ticket-tokyo/ æš«æŠ“2-3å°æ™‚ å·²è³¼è²·é–€ç¥¨",
                                    "map": "https://www.google.com/maps/search/?api=1&query=teamLab Borderless éº»å¸ƒå°"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "London Sports",
                                    "time": "10:30",
                                    "desc": "10:30â€“20:30 https://maps.app.goo.gl/BKQq1U8Fsijp98ca7  æœ€ä¾¿å®œ ä½†å¤§å¤šæ˜¯èˆŠæ¬¾å¼æˆ–é›¶ç¢¼æ¬¾å¼",
                                    "map": "https://maps.app.goo.gl/BKQq1U8Fsijp98ca7"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Nanamica ä»£å®˜å±±",
                                    "time": "11:00",
                                    "desc": "11:00â€“19:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Nanamica ä»£å®˜å±±"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Murasaki Sports ç¥ç”°å°å·ç”ºåº—",
                                    "time": "11:00",
                                    "desc": "11:00â€“20:00 https://maps.app.goo.gl/aDsxvETY5sDDnaS18 å…¨æ—¥æœ¬é€£é–",
                                    "map": "https://maps.app.goo.gl/aDsxvETY5sDDnaS18"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Victoria Main Shop / ãƒ´ã‚£ã‚¯ãƒˆãƒªã‚¢ å¾¡èŒ¶ãƒæ°´æœ¬åº—",
                                    "time": "11:00",
                                    "desc": "11:00-20:00 https://maps.app.goo.gl/id1ZMpBtip9mw89P6 è¼ƒå¤§åŠæ¬¾å¼é½Šå…¨, ä½†è«–æŠ˜æ‰£æœªå¿…æ¯”å¾—ä¸Šå…¶ä»–å°åº—",
                                    "map": "https://maps.app.goo.gl/id1ZMpBtip9mw89P6"
                        },
                        {
                                    "cat": "å…¶ä»–",
                                    "icon": "â“",
                                    "title": "Alpen Tokyo æ–°å®¿",
                                    "time": "11:00",
                                    "desc": "11:00â€“22:00 é‹å‹•ç”¨å“åº— è²·è»Ÿæ°´å£º 1F é‹å‹•é‹ 2Fç”·æ€§é‹å‹•æ½®æµæœé£¾ 3Fï¼šæˆ¶å¤–ä¼‘é–’æœé£¾  5FOutdoorç”¨å“ (æœ‰èª¿å‘³ç²‰) 8Fé›ªå…·",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Alpen Tokyo æ–°å®¿"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Coverchord æ—¥ç‰Œé¸ç‰©åº—",
                                    "time": "11:00",
                                    "desc": "11:00â€“19:00 ä¸­ç›®é»‘ A.PRESSEã€COMOLIã€AURALEE ã€GRAPHPAPERã€KAPTAIN SUNSHINEã€UNLIKELY ã€DAIWA PIER39",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Coverchord æ—¥ç‰Œé¸ç‰©åº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Pensta LUMINE ESTæ–°å®¿åº—",
                                    "time": "11:00",
                                    "desc": "11:00â€“21:00 B1æ¨“",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Pensta LUMINE ESTæ–°å®¿åº—"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "åˆé¤ - å’Œé£Ÿ ä¸€èŠ¯",
                                    "time": "11:30",
                                    "desc": "å…ˆæ’ï¼ 11:30â€“14:00 17:00â€“23:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=åˆé¤ - å’Œé£Ÿ ä¸€èŠ¯"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "Le Bretagne Creperie",
                                    "time": "11:30",
                                    "desc": "11:30-22:00 æ²’å»é›ªå…·è¡—çš„è©±å¯å» https://maps.app.goo.gl/2SqVMUohx6NWpuZJ8?g_st=ipc",
                                    "map": "https://maps.app.goo.gl/2SqVMUohx6NWpuZJ8?g_st=ipc"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Snowboard shop MDS",
                                    "time": "12:00",
                                    "desc": "12:00-20:00 https://maps.app.goo.gl/h6tggAUAhnabJrEf9 ä½æ–¼å…§è¡—çš„åº—èˆ–, æŠ˜æ‰£è¼ƒå¤š",
                                    "map": "https://maps.app.goo.gl/h6tggAUAhnabJrEf9"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "1LDK apartments.",
                                    "time": "13:00",
                                    "desc": "13:00â€“19:00 é€›ssstein",
                                    "map": "https://www.google.com/maps/search/?api=1&query=1LDK apartments."
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "Lady Gaga æ¼”å”±æœƒ",
                                    "time": "17:00",
                                    "desc": "Show Date: Jan 29/2026  17:00 é–‹æ”¾é€²å ´ 19:00 é–‹æ¼” é è¨ˆ22:00çµæŸ å¯èƒ½ 17:30-18:00 åˆ°å·¨è›‹",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Lady Gaga æ¼”å”±æœƒ"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "Iâ€™m donut ? ä¸­ç›®é»‘",
                                    "time": "",
                                    "desc": "",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Iâ€™m donut ? ä¸­ç›®é»‘"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "HOMME PLISSÃ‰  ä»£å®˜å±±åº—",
                                    "time": "",
                                    "desc": "",
                                    "map": "https://www.google.com/maps/search/?api=1&query=HOMME PLISSÃ‰  ä»£å®˜å±±åº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "BRICK & MORTAR",
                                    "time": "",
                                    "desc": "å®¶é£¾åº—",
                                    "map": "https://www.google.com/maps/search/?api=1&query=BRICK & MORTAR"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "NUMBER SUGAR ä»£å®˜å±±",
                                    "time": "",
                                    "desc": "ç‰›å¥¶ç³– / ä¼´æ‰‹ç¦®",
                                    "map": "https://www.google.com/maps/search/?api=1&query=NUMBER SUGAR ä»£å®˜å±±"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ™šé¤ - Lawson / 711 / å…¨å®¶",
                                    "time": "",
                                    "desc": "ç›´æ¥é£¯åº—é™„è¿‘è¶…å•†ç°¡å–®è§£æ±º é †ä¾¿è²·éš”å¤©æ—©é¤ï¼",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ™šé¤ - Lawson / 711 / å…¨å®¶"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "è”¦å±‹æ›¸åº—ä»£å®˜å±±",
                                    "time": "",
                                    "desc": "J-Scenté¦™æ°´",
                                    "map": "https://www.google.com/maps/search/?api=1&query=è”¦å±‹æ›¸åº—ä»£å®˜å±±"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "éŠ€åº§æ«»èŠ±æ¨¹",
                                    "time": "",
                                    "desc": "äº¬æ©‹å¤§æ ¹æ²³å²¸æœèœå¸‚å ´éºè·¡ä¹‹ç¢‘",
                                    "map": "https://www.google.com/maps/search/?api=1&query=éŠ€åº§æ«»èŠ±æ¨¹",
                                    "img": "New Database/%E9%8A%80%E5%BA%A7%E6%AB%BB%E8%8A%B1%E6%A8%B9/IMG_3534.jpg"
                        }
            ],
            "4": [
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "é£¯åº— â†’ æ±äº¬è»Šç«™",
                                    "time": "05:30",
                                    "desc": "é è¨ˆ 05:30 èµ·åºŠ â€¢ 06:31â†’06:40 2è™Ÿæœˆå°å±±æ‰‹ç·š",
                                    "map": "https://www.google.com/maps/search/?api=1&query=é£¯åº— â†’ æ±äº¬è»Šç«™"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "æ±äº¬ â†’ å±±å½¢",
                                    "time": "07:12",
                                    "desc": "æ–°å¹¹ç·š â€¢ 07:12â†’09:53 (2h41m) å¾è¥¿å£å‡ºç«™ï¼ - JR passåæ—¥ 48,000æ—¥åœ“ (æ–°å¹¹ç·šå–®è²·ä¾†å›åªè¦22860æ—¥åœ“) å–®ç¨‹ä¸€äºº 11250 + 11450æ—¥åœ“",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ±äº¬ â†’ å±±å½¢"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "é‡å·è±†è…å±‹",
                                    "time": "09:30",
                                    "desc": "é†‰æ—…å®¿æ¨è–¦ https://maps.app.goo.gl/8Nor6sdx6CHha6wUA 09:30-18:00",
                                    "map": "https://maps.app.goo.gl/8Nor6sdx6CHha6wUA"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "https://tabelog.com/tw/yamagata/A0601/A060101/6000003/ 3.67",
                                    "time": "11:00",
                                    "desc": "11:00â€“15:30 17:00â€“20:00 ä¸€ä¼‘ é›¢é£¯åº—æ­¥è¡Œ12åˆ†é˜",
                                    "map": "https://www.google.com/maps/search/?api=1&query=https://tabelog.com/tw/yamagata/A0601/A060101/6000003/ 3.67"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "https://japantravel.navitime.com/zh-tw/area/jp/route/result/?start=00003107&goal=00005661&start_name=%E5%B1%B1%E5%BD%A2&goal_name=%E5%A4%A7%E7%9F%B3%E7%94%B0&cid=&from=route_top_search_box&date_time=2026-01-27T12:50",
                                    "time": "14:44",
                                    "desc": "14:44 â†’ 15:15 æ–°å¹¹ç·š Â¥1,970èµ· 14:52 â†’ 15:41 Â¥680",
                                    "map": "https://www.google.com/maps/search/?api=1&query=https://japantravel.navitime.com/zh-tw/area/jp/route/result/?start=00003107&goal=00005661&start_name=%E5%B1%B1%E5%BD%A2&goal_name=%E5%A4%A7%E7%9F%B3%E7%94%B0&cid=&from=route_top_search_box&date_time=2026-01-27T12:50"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "å±±å½¢è»Šç«™ â†’ éŠ€å±±æº«æ³‰",
                                    "time": "15:45",
                                    "desc": "JRå¤§çŸ³ç”°ç«™ é£¯åº—æ¥é§å·´å£« 15:45å‡ºç™¼ æœ‰å·¥ä½œäººå“¡åœ¨å‡ºå£æ‹¿æ¿å­ç¢ºèª å·´å£«åœåœ¨å¤§çŸ³ç”°å‡ºå£å·¦è½‰è™•",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å±±å½¢è»Šç«™ â†’ éŠ€å±±æº«æ³‰"
                        },
                        {
                                    "cat": "ä½å®¿",
                                    "icon": "ğŸ›ŒğŸ»",
                                    "title": "å¤å‹¢èµ·å±‹ æœ¬é¤¨",
                                    "time": "",
                                    "desc": "å·²æ”¯ä»˜",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å¤å‹¢èµ·å±‹ æœ¬é¤¨"
                        },
                        {
                                    "cat": "å…¶ä»–",
                                    "icon": "â“",
                                    "title": "è¶…å¸‚MaxValu Yamagata Station West / å…¨å®¶ / 7-Eleven",
                                    "time": "",
                                    "desc": "è£œè²¨ï¼ è¶…å¸‚ https://maps.app.goo.gl/bKVTvFdc8n73iVb38 å…¨å®¶ å±±å½¢éœåŸã‚»ãƒ³ãƒˆãƒ©ãƒ«åº—: https://maps.app.goo.gl/vkXroad5mjt5nCcg7 711 Yamagata Station West:  https://maps.app.goo.gl/WmTBBo2DFGGYFurK9",
                                    "map": "https://maps.app.goo.gl/bKVTvFdc8n73iVb38"
                        },
                        {
                                    "cat": "å…¶ä»–",
                                    "icon": "â“",
                                    "title": "å±±å½¢ç«™å‰é‡Œå£«æ»¿é£¯åº—",
                                    "time": "",
                                    "desc": "å…ˆæ”¾è¡Œæ é›¢è»Šç«™æ­¥è¡Œ3åˆ†é˜ 12/1 å·²ç¢ºèªå¯ä»¥å…ˆæå‰æ”¾è¡Œæ",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å±±å½¢ç«™å‰é‡Œå£«æ»¿é£¯åº—",
                                    "img": "New Database/%E5%B1%B1%E5%BD%A2%E7%AB%99%E5%89%8D%E9%87%8C%E5%A3%AB%E6%BB%BF%E9%A3%AF%E5%BA%97/IMG_1347.jpeg"
                        }
            ],
            "5": [
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "éœåŸã‚»ãƒ³ãƒˆãƒ©ãƒ«å±•æœ›ãƒ­ãƒ“ãƒ¼",
                                    "time": "07:00",
                                    "desc": "07:00â€“23:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=éœåŸã‚»ãƒ³ãƒˆãƒ©ãƒ«å±•æœ›ãƒ­ãƒ“ãƒ¼"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Workman",
                                    "time": "07:00",
                                    "desc": "07:00â€“20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Workman"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "ç«‹çŸ³å¯º",
                                    "time": "08:00",
                                    "desc": "08:00â€“16:00 ç‰ã“ã‚“ã«ã‚ƒãï¼ˆç‰è’Ÿè’»ï¼‰",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ç«‹çŸ³å¯º",
                                    "img": "New Database/%E7%AB%8B%E7%9F%B3%E5%AF%BA/rissyauji_shrine.jpg"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "åˆé¤ - ãŠä¼‘å‡¦å¯¾é¢çŸ³",
                                    "time": "09:00",
                                    "desc": "09:00-17:00 https://tabelog.com/tw/yamagata/A0601/A060101/6002406/",
                                    "map": "https://www.google.com/maps/search/?api=1&query=åˆé¤ - ãŠä¼‘å‡¦å¯¾é¢çŸ³"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "hatake style ã‚¨ã‚¹ãƒ‘ãƒ«å±±å½¢åº—",
                                    "time": "09:30",
                                    "desc": "09:30â€“19:30 ç«™å‰å’–å•¡å»³",
                                    "map": "https://www.google.com/maps/search/?api=1&query=hatake style ã‚¨ã‚¹ãƒ‘ãƒ«å±±å½¢åº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "Montbell",
                                    "time": "10:00",
                                    "desc": "10:00â€“20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Montbell"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "ãŸã„ã‚„ãã‚„ éŠ€ã®é¾é¯›é­šç‡’",
                                    "time": "10:00",
                                    "desc": "10:00-16:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ãŸã„ã‚„ãã‚„ éŠ€ã®é¾é¯›é­šç‡’"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "éŠ€å±±æº«æ³‰è¡— â†’ å¤§çŸ³ç”°",
                                    "time": "10:20",
                                    "desc": "10:20 æ¥é§è»Šç™¼è»Š é ä¼°è»Šç¨‹40-50åˆ†",
                                    "map": "https://www.google.com/maps/search/?api=1&query=éŠ€å±±æº«æ³‰è¡— â†’ å¤§çŸ³ç”°",
                                    "img": "New Database/%E9%8A%80%E5%B1%B1%E6%BA%AB%E6%B3%89%E8%A1%97 %E2%86%92 %E5%A4%A7%E7%9F%B3%E7%94%B0/17644073002812x.jpg"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "19:00 Al-che Cciano Con cert",
                                    "time": "11:30",
                                    "desc": "11:30â€“14:00 17:00â€“20:00 ç¾©å¼é¤å»³ å·²è¨‚ä½  https://tabelog.com/yamagata/A0601/A060101/6011073/",
                                    "map": "https://www.google.com/maps/search/?api=1&query=19:00 Al-che Cciano Con cert"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "å¤§çŸ³ç”° â†’ å±±å¯ºç«™",
                                    "time": "11:55",
                                    "desc": "11:55â†’13:09 (1h14m) å¥§ç¾½æœ¬ç·šæ­12ç«™ åœ¨ç¾½å‰åƒæ­³ç«™ æ›æ­ä»™å±±ç·š Â¥770",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å¤§çŸ³ç”° â†’ å±±å¯ºç«™"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "å±±å¯ºç«™ â†’ å±±å½¢è»Šç«™",
                                    "time": "14:56",
                                    "desc": "14:56â†’15:16 15:51â†’16:17 (26m) 16:55â†’17:14 Â¥242",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å±±å¯ºç«™ â†’ å±±å½¢è»Šç«™"
                        },
                        {
                                    "cat": "ä½å®¿",
                                    "icon": "ğŸ›ŒğŸ»",
                                    "title": "å±±å½¢ç«™å‰é‡Œå£«æ»¿é£¯åº—",
                                    "time": "",
                                    "desc": "https://www.notion.so/21437953514480fbb1d0e9da00fe67dc?pvs=21 Agoda",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å±±å½¢ç«™å‰é‡Œå£«æ»¿é£¯åº—"
                        }
            ],
            "6": [
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "ã‹ã—ã‡ã‚‹",
                                    "time": "11:00",
                                    "desc": "11:00â€“14:00 18:00â€“21:00 æˆå‰æ€æ±—çƒ¤è‚‰",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ã‹ã—ã‡ã‚‹"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "éŸ³èŒ¶å±‹(ã‚ªãƒˆãƒãƒ£ãƒ¤)",
                                    "time": "11:00",
                                    "desc": "11:00â€“16:00 17:30â€“20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=éŸ³èŒ¶å±‹(ã‚ªãƒˆãƒãƒ£ãƒ¤)"
                        },
                        {
                                    "cat": "ä½å®¿",
                                    "icon": "ğŸ›ŒğŸ»",
                                    "title": "Onsen & Stay OakHill",
                                    "time": "15:00",
                                    "desc": "å…ˆå¯„æ”¾è¡Œæï¼›é è¨ˆ 15:00 Check in - åˆ°è—ç‹æº«æ³‰å·´å£«ç¸½ç«™å¾Œæ‰“é›»è©±çµ¦é£¯åº—æœƒæœ‰æ¥é§è»Šä¾†æ¥ é›»è©±ï¼šhttps://www.google.com/search?q=onsen+and+stay+oakhill&oq=onsen&gs_lcrp=EgZjaHJvbWUqDAgBECMYJxiABBiKBTIOCAAQRRg5GEMYgAQYigUyDAgBECMYJxiABBiKBTIMCAIQABhDGIAEGIoFMhMIAxAuGK8BGMcBGIAEGJgFGJkFMgcIBBAAGIAEMgcIBRAAGIAEMgwIBhAAGEMYgAQYigUyBggHEEUYPNIBCDYwMzFqMGoxqAIAsAIA&sourceid=chrome&ie=UTF-8# - https://www.onestayapp.com/v2/checkin/search?checkin_code=18993886&pin_code=e8mdm0dh73&referral=email (é å…ˆå ±åˆ°Check in) Jalan",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Onsen & Stay OakHill"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "å¯¿ã—å–œã‚‰ã",
                                    "time": "17:30",
                                    "desc": "17:30 - 21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å¯¿ã—å–œã‚‰ã"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "å±±å½¢é§…å‰å·´å£«æ¡ˆå…§æ‰€ â†’ è—ç‹æº«æ³‰å·´å£«ç¸½ç«™ï¼š45åˆ†",
                                    "time": "6:50",
                                    "desc": "å¾æ±å£å‡ºç«™ï¼ 1. è²·å‰å¾€è—ç‹è»Šç¥¨ 2. å…¬å…±é›»è©±æ‰“çµ¦é£¯åº—æ´¾æ¥é§è»Š  1è™Ÿå€™è»Šè™•( æ¯ä¸€å°æ™‚ä¸€ç­è»Š ) https://www.yamakobus.jp/a4ba73198eff7b52d13a643791cbf18728185b5a.pdf æœ€æ—© 6:50 - 7:26 é æŠ“ https://travel.yamakobus.jp/zh-tw/timetable/routebus-yamagata-zaoline.html 2025å¹´12æœˆ27æ—¥ ã€œ 2026å¹´2æœˆ22æ—¥ï¼ˆæœŸé–“å…§çš„36å¤©ï¼‰ï¼Œé»ç‡ˆæ™‚é–“æ˜¯17:00 - 21:00ã€‚",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å±±å½¢é§…å‰å·´å£«æ¡ˆå…§æ‰€ â†’ è—ç‹æº«æ³‰å·´å£«ç¸½ç«™ï¼š45åˆ†",
                                    "img": "New Database/%E5%B1%B1%E5%BD%A2%E9%A7%85%E5%89%8D%E5%B7%B4%E5%A3%AB%E6%A1%88%E5%85%A7%E6%89%80 %E2%86%92 %E8%97%8F%E7%8E%8B%E6%BA%AB%E6%B3%89%E5%B7%B4%E5%A3%AB%E7%B8%BD%E7%AB%99%EF%BC%9A45%E5%88%86/IMG_1743.jpeg"
                        },
                        {
                                    "cat": "ä½œæ¥­",
                                    "icon": "ğŸ“‹",
                                    "title": "Skiing Now Zao é¬§é›ªå…·è—ç‹åº—",
                                    "time": "7:30",
                                    "desc": "ä¸Šã®å°çºœè»Šæ— Wonderworld ski school ç¾å¥½æ»‘é›ªåŸºåœ° ç‡Ÿæ¥­æ™‚é–“ï¼šÂ 7:30-21:00 âœ…12/15å·²ç·šä¸Šé ç´„ ä½¿ç”¨ç•¶å¤©éœ€æå‰ä¸€å€‹åŠå°æ™‚åˆ°åº—",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Skiing Now Zao é¬§é›ªå…·è—ç‹åº—"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "ä¸Šã®å° Base Center JUPEER",
                                    "time": "8:30",
                                    "desc": "https://tw.wamazing.com/snow/items/13240?fbclid=IwY2xjawNJcjVleHRuA2FlbQIxMABicmlkETFLRk1Vck1MUzR6cEppb2xyAR6RLlJavEXoaDUD7MQgHOMuTTMVxU5ujf1RgHZ4wh1emmcBXI9cqGdsuAeIEg_aem_jPVSoFNZtLgaAu2Kir0t0g âœ…Â è‡ªå‹•å”®ç¥¨æ©Ÿç”¨å®Œç¾è¡ŒQRCodeå–ç¥¨ å¹³æ—¥ã€é€±å…­ã€åœ‹å®šå‡æ—¥ï¼š8:30-17:00 å¤œæ»‘ï¼š17:00-21:00 ï¼ˆé™¤å¤©å€™ä¸ä½³ä¸é–‹æ”¾ï¼‰",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ä¸Šã®å° Base Center JUPEER"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "è—ç‹æº«æ³‰ æºä¸ƒéœ²å¤©ä¹‹æ¹¯",
                                    "time": "",
                                    "desc": "",
                                    "map": "https://www.google.com/maps/search/?api=1&query=è—ç‹æº«æ³‰ æºä¸ƒéœ²å¤©ä¹‹æ¹¯"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "è”µç‹æ¸©æ³‰ã€Œã‚ã°ãŸã€",
                                    "time": "",
                                    "desc": "æˆå‰æ€æ±—çƒ¤è‚‰",
                                    "map": "https://www.google.com/maps/search/?api=1&query=è”µç‹æ¸©æ³‰ã€Œã‚ã°ãŸã€"
                        }
            ],
            "7": [
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "è”µç‹éººå‡¦ æ¢¨åºµ(ã‚Šã‚ã‚“)",
                                    "time": "11:30",
                                    "desc": "ç„¡å…¬ä¼‘ 11:30â€“15:00 17:30â€“21:30",
                                    "map": "https://www.google.com/maps/search/?api=1&query=è”µç‹éººå‡¦ æ¢¨åºµ(ã‚Šã‚ã‚“)"
                        }
            ],
            "8": [
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "å¤§åœ‹è—¥å¦ ä»™å°Clis Roadåº—",
                                    "time": "08:05",
                                    "desc": "08:05â€“22:50 è—¥å¦æ¡è²·",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å¤§åœ‹è—¥å¦ ä»™å°Clis Roadåº—"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "ä¸‰äº”éƒå°å±‹",
                                    "time": "10:00",
                                    "desc": "10:00â€“16:00 æ™šé¤ä¸é–‹æ”¾ä½å®¢ä»¥å¤–çš„äºº",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ä¸‰äº”éƒå°å±‹"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "AER å±•æœ›å°ãƒ†ãƒ©ã‚¹",
                                    "time": "10:00",
                                    "desc": "10:00â€“20:00 JRä»™å°ç«™æ­¥è¡Œç´„2åˆ†é˜ 31F è¥¿å´èˆ‡æ±å´è§€æ™¯è‡ºå…è²»é–‹æ”¾",
                                    "map": "https://www.google.com/maps/search/?api=1&query=AER å±•æœ›å°ãƒ†ãƒ©ã‚¹"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "ç„¡å°è‰¯å“ ä»™å°ãƒ­ãƒ•ãƒˆ",
                                    "time": "10:00",
                                    "desc": "10:00-20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ç„¡å°è‰¯å“ ä»™å°ãƒ­ãƒ•ãƒˆ"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "UNIQLO ãƒ¨ãƒ‰ãƒã‚·ä»™å°åº—",
                                    "time": "10:00",
                                    "desc": "10:00-21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=UNIQLO ãƒ¨ãƒ‰ãƒã‚·ä»™å°åº—"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "é¯›ãã¡ åæ›ä¸åº—",
                                    "time": "10:30",
                                    "desc": "10:30-19:30ï¼ˆéºµç³Šè³£å®Œå°±æ‰“çƒŠï¼‰",
                                    "map": "https://www.google.com/maps/search/?api=1&query=é¯›ãã¡ åæ›ä¸åº—"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ™šé¤ - DASHIRO ã ã—å»Š",
                                    "time": "11:00",
                                    "desc": "11:00-21:00 ç„¡å…¬ä¼‘ã€ç„¡æ³•é ç´„ ç±³å…¶æ—æ¨è–¦ & Tabelog 2024æ‹‰éºµç™¾ååº—å…¥é¸åº—ğŸ† https://tabelog.com/tw/miyagi/A0401/A040101/4019493/",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ™šé¤ - DASHIRO ã ã—å»Š"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "è—ç‹å·´å£«æ¡ˆå…§æ‰€",
                                    "time": "15:20",
                                    "desc": "https://www.yamakobus.jp/a4ba73198eff7b52d13a643791cbf18728185b5a.pdf é æŠ“ 15:20 - 16:05",
                                    "map": "https://www.google.com/maps/search/?api=1&query=è—ç‹å·´å£«æ¡ˆå…§æ‰€"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "ç‚‰ç«¯ã¨ãŠã§ã‚“ å‘¼ç‚‰å‡ªæ¥ ä»™å°é§…å‰åº—",
                                    "time": "16:00",
                                    "desc": "16:00â€“00:00 å®µå¤œï¼Œæœ‰åŠ›æ°£è·Ÿèƒƒå°±å»",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ç‚‰ç«¯ã¨ãŠã§ã‚“ å‘¼ç‚‰å‡ªæ¥ ä»™å°é§…å‰åº—"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "å±±å½¢ â†’ ä»™å°",
                                    "time": "16:14",
                                    "desc": "16:14 - 17:33 16:29 - 17:48 16:44 - 18:03",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å±±å½¢ â†’ ä»™å°"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "å‚™æ¡ˆæ™šé¤ - é¦¬éˆ´è–¯",
                                    "time": "17:00",
                                    "desc": "17:00-22:00 æ—¥ã€ä¸‰å…¬ä¼‘ https://s.tabelog.com/tw/miyagi/A0401/A040101/4007879/",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å‚™æ¡ˆæ™šé¤ - é¦¬éˆ´è–¯"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "ãšã‚“ã èŒ¶å¯® ä»™å°é§…ãšã‚“ã å°å¾„åº—",
                                    "time": "8:00",
                                    "desc": "8:00-21:00 ç„¡å…¬ä¼‘æ—¥  ä»™å°ç«™3F",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ãšã‚“ã èŒ¶å¯® ä»™å°é§…ãšã‚“ã å°å¾„åº—",
                                    "img": "New Database/%E3%81%9A%E3%82%93%E3%81%A0%E8%8C%B6%E5%AF%AE %E4%BB%99%E5%8F%B0%E9%A7%85%E3%81%9A%E3%82%93%E3%81%A0%E5%B0%8F%E5%BE%84%E5%BA%97/IMG_0018.jpeg"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "åæ›ä¸å•†åº—è¡—",
                                    "time": "",
                                    "desc": "é€›è¡—æ”»ç•¥ï¼šhttp://bring-you.info/zh-tw/sendai-commercial-street",
                                    "map": "https://www.google.com/maps/search/?api=1&query=åæ›ä¸å•†åº—è¡—"
                        },
                        {
                                    "cat": "ä½å®¿",
                                    "icon": "ğŸ›ŒğŸ»",
                                    "title": "ä»™å°è¥¿å£å¤§å’Œé­¯å…§ PREMIER é£¯åº—",
                                    "time": "",
                                    "desc": "Agoda å…ˆæ”¾è¡Œæ",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ä»™å°è¥¿å£å¤§å’Œé­¯å…§ PREMIER é£¯åº—"
                        }
            ],
            "9": [
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "Date Cafe Oâ€™rder",
                                    "time": "07:15",
                                    "desc": "ä»™å°é§… 2F 07:15-20:45",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Date Cafe Oâ€™rder"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "110 coffee (ã‚¤ãƒˆãƒ¼ã‚³ãƒ¼ãƒ’ãƒ¼)",
                                    "time": "08:00",
                                    "desc": "08:00â€“16:00 ~è€é—†æ–°å¹´åœ¨ä¼‘é•·å‡ä¸­~",
                                    "map": "https://www.google.com/maps/search/?api=1&query=110 coffee (ã‚¤ãƒˆãƒ¼ã‚³ãƒ¼ãƒ’ãƒ¼)"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "ç‘å·–å¯º",
                                    "time": "08:30",
                                    "desc": "08:30â€“16:30",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ç‘å·–å¯º"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "ç‘å·–å¯ºäº”å¤§å ‚",
                                    "time": "08:30",
                                    "desc": "08:30â€“16:30 é¤ç©ºæ©‹",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ç‘å·–å¯ºäº”å¤§å ‚",
                                    "img": "New Database/%E7%91%9E%E5%B7%96%E5%AF%BA%E4%BA%94%E5%A4%A7%E5%A0%82/%E6%88%AA%E5%9C%96_2025-12-06_15.18.44.png"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "é½‹è—¤æƒ£èœåº— ã“ã‚ã£ã‘ã‚„",
                                    "time": "09:00",
                                    "desc": "å¯æ¨‚é¤… 09:00â€“17:00 https://tabelog.com/miyagi/A0401/A040101/4002163/",
                                    "map": "https://www.google.com/maps/search/?api=1&query=é½‹è—¤æƒ£èœåº— ã“ã‚ã£ã‘ã‚„"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ—©é¤ - ç‰¡è £ã¨å¯¿å¸æœå¸‚ç·æœ¬åº—",
                                    "time": "09:00",
                                    "desc": "09:00-14:00 ç„¡å…¬ä¼‘",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ—©é¤ - ç‰¡è £ã¨å¯¿å¸æœå¸‚ç·æœ¬åº—"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "å††é€šé™¢ï¼ˆå…«é€šé™¢ï¼‰",
                                    "time": "09:00",
                                    "desc": "09:00-16:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å††é€šé™¢ï¼ˆå…«é€šé™¢ï¼‰"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "æ¾å³¶è’²é‰¾æœ¬èˆ— ç·æœ¬åº—",
                                    "time": "09:30",
                                    "desc": "ä¼´æ‰‹ç¦®ã€è‡ªå·±çƒ¤é­šæ¿ 09:30-16:30 ç„¡å…¬ä¼‘",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ¾å³¶è’²é‰¾æœ¬èˆ— ç·æœ¬åº—"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "ã‚µãã‚µãå¯é Œ",
                                    "time": "10:00",
                                    "desc": "10:00-17:00 ç¦®æ‹œäºŒå…¬ä¼‘",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ã‚µãã‚µãå¯é Œ"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ¾å³¶é›ªç«¹å±‹",
                                    "time": "10:00",
                                    "desc": "ç¾çƒ¤ä»™è² ç„¡å…¬ä¼‘æ—¥ 10:00â€“17:30",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ¾å³¶é›ªç«¹å±‹"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "é˜¿éƒ¨è’²é‰¾åº— æœ¬åº—",
                                    "time": "10:00",
                                    "desc": "ç‚¸è‘«è˜† 10:00-18:30",
                                    "map": "https://www.google.com/maps/search/?api=1&query=é˜¿éƒ¨è’²é‰¾åº— æœ¬åº—"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "ä»™å° â†’ æ¾å³¶æµ·å²¸",
                                    "time": "10:09",
                                    "desc": "JR ä»™çŸ³ç·š 10è™Ÿæœˆå° 10:09 â†’ 10:48 10:29 â†’ 11:08 10:49 â†’ 11:28 ä»™å°è»Šç«™åˆ°æ¾å³¶æµ·å²¸ç«™å–®è¶Ÿç´„40åˆ† ä¾†å›è»Šç¥¨ 840 æ—¥åœ“",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ä»™å° â†’ æ¾å³¶æµ·å²¸"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "MARLOWE å¸ƒä¸",
                                    "time": "10:30",
                                    "desc": "GINZA SIX B1 10:30â€“20:30",
                                    "map": "https://www.google.com/maps/search/?api=1&query=MARLOWE å¸ƒä¸"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ¼å¸«ã®æµ·é®®ä¸¼",
                                    "time": "11:00",
                                    "desc": "11:00-15:00 å››äº”å…¬ä¼‘ã€ç„¡æ³•é ç´„ æ¾å³¶æµ·å²¸ç«™å‡ºä¾†å¾Œå·¦è½‰æ­¥è¡Œä¸‰åˆ†é˜",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ¼å¸«ã®æµ·é®®ä¸¼"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "æ¾å³¶æµ·å²¸ â†’ ä»™å°",
                                    "time": "12:33",
                                    "desc": "12:33 â†’ 13:10 12:53 â†’ 13:31 13:11 â†’ 13:49",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ¾å³¶æµ·å²¸ â†’ ä»™å°"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "ä»™å° â†’ ä¸Šé‡",
                                    "time": "14:57",
                                    "desc": "14:57â†’16:26",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ä»™å° â†’ ä¸Šé‡"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "å®µå¤œ - ä¸²ç„¼ãã¨å¤©ã·ã‚‰ æ˜¥å­å±‹",
                                    "time": "15:00",
                                    "desc": "15:00-23:00 (22:30æœ€å¾Œé»é¤)  å·²ç”¨LINEè¨‚ä½ 22:00 https://www.threads.com/@x_______t/post/DP0MzC5j_FD?xmt=AQF0vf600lZ4BRPAe5UWgrRWhjqWdG0ty0WpCp6DXvo5j8-BjwvmBdIJAihpLYJ76L5jIWwc&slof=1",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å®µå¤œ - ä¸²ç„¼ãã¨å¤©ã·ã‚‰ æ˜¥å­å±‹"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ™šé¤ - éº¥èˆ‡æ©„æ¬–",
                                    "time": "17:30",
                                    "desc": "ç„¡æ³•é ç´„ 17:30-21:30",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ™šé¤ - éº¥èˆ‡æ©„æ¬–"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "BEAMS éŠ€åº§åº—",
                                    "time": "20:00",
                                    "desc": "11â€¯:00-20:00 https://maps.app.goo.gl/s53Lm7y1hWGfvUzs5",
                                    "map": "https://maps.app.goo.gl/s53Lm7y1hWGfvUzs5"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "HOMME PLISSE ISSEY MIYAKE Hankyu Menâ€™s Tokyo Store",
                                    "time": "20:00",
                                    "desc": "-20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=HOMME PLISSE ISSEY MIYAKE Hankyu Menâ€™s Tokyo Store"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "ç„¡å°è‰¯å“ éŠ€åº§",
                                    "time": "21:00",
                                    "desc": "11â€¯:00-21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ç„¡å°è‰¯å“ éŠ€åº§"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "UNIQLO",
                                    "time": "21:00",
                                    "desc": "11â€¯:00-21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=UNIQLO"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ—©é¤ - imosenè•éº¥éºµ",
                                    "time": "7:30",
                                    "desc": "7:30â€“14:30",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ—©é¤ - imosenè•éº¥éºµ"
                        },
                        {
                                    "cat": "ä½å®¿",
                                    "icon": "ğŸ›ŒğŸ»",
                                    "title": "ä¸Šé‡å¯¶çŸ³é£¯åº— Hotel sardonyx ueno",
                                    "time": "",
                                    "desc": "å…ˆæ”¾è¡Œæ å·²æ”¯ä»˜",
                                    "map": "https://www.google.com/maps/search/?api=1&query=ä¸Šé‡å¯¶çŸ³é£¯åº— Hotel sardonyx ueno"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "S-PAL",
                                    "time": "",
                                    "desc": "å¦‚æœå‰ä¸€å¤©æœ‰å»å°±å¯ç•¥é æœ¬é¤¨ 1F ç„¡å° 2F Adam et rope æ±é¤¨ 3F Freakâ€™s Storeã€columbia",
                                    "map": "https://www.google.com/maps/search/?api=1&query=S-PAL"
                        },
                        {
                                    "cat": "ä½œæ¥­",
                                    "icon": "ğŸ“‹",
                                    "title": "å…ˆå¯„æ”¾è¡Œæ",
                                    "time": "",
                                    "desc": "",
                                    "map": "https://www.google.com/maps/search/?api=1&query=å…ˆå¯„æ”¾è¡Œæ"
                        }
            ],
            "10": [
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "FUGLEN ASAKUSA",
                                    "time": "08:00",
                                    "desc": "08:00â€“21:00 å·²ç¢ºèªç„¡å…¬ä¼‘",
                                    "map": "https://www.google.com/maps/search/?api=1&query=FUGLEN ASAKUSA"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "æ—©é¤ - February Cafe",
                                    "time": "08:15",
                                    "desc": "08:15â€“17:00 å·²ç¢ºèªç„¡å…¬ä¼‘ã€ç„¡æ³•é ç´„",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ—©é¤ - February Cafe"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "PENSTA ecuteä¸Šé‡åº— (è³£åº—)",
                                    "time": "09:00",
                                    "desc": "3F æ”¹æœ­å†… ã‚¨ã‚­ãƒ¥ãƒ¼ãƒˆä¸Šé‡å†… 09:00â€“21:00 æ–°å®¿æœ‰å»å°±ä¸ç”¨",
                                    "map": "https://www.google.com/maps/search/?api=1&query=PENSTA ecuteä¸Šé‡åº— (è³£åº—)"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "Doughnut Moriä¸Šé‡åº—",
                                    "time": "09:00",
                                    "desc": "3F æ”¹æœ­å†… 09:00-21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=Doughnut Moriä¸Šé‡åº—"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "TRUFFLE mini å¾¡å¾’ç”ºåº—",
                                    "time": "09:00",
                                    "desc": "09:00â€“21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=TRUFFLE mini å¾¡å¾’ç”ºåº—"
                        },
                        {
                                    "cat": "è³¼ç‰©",
                                    "icon": "ğŸ›ï¸",
                                    "title": "KURAMAE CANNELE ã‚¨ã‚­ãƒ¥ãƒ¼ãƒˆä¸Šé‡åº—",
                                    "time": "10:00",
                                    "desc": "3F æ”¹æœ­å†… 10:00-20:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=KURAMAE CANNELE ã‚¨ã‚­ãƒ¥ãƒ¼ãƒˆä¸Šé‡åº—"
                        },
                        {
                                    "cat": "åƒå–",
                                    "icon": "ğŸœ",
                                    "title": "åˆé¤ - é³¥ã¤ã­æ¹¯å³¶å¤©ç¥å‰åº—",
                                    "time": "11:00",
                                    "desc": "11:00â€“13:30 17:00â€“21:00",
                                    "map": "https://www.google.com/maps/search/?api=1&query=åˆé¤ - é³¥ã¤ã­æ¹¯å³¶å¤©ç¥å‰åº—"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "12:20 ä¸Šé‡å‡ºç™¼",
                                    "time": "13:01",
                                    "desc": "13:01 åˆ°æˆç”°æ©Ÿå ´",
                                    "map": "https://www.google.com/maps/search/?api=1&query=12:20 ä¸Šé‡å‡ºç™¼"
                        },
                        {
                                    "cat": "ç§»å‹•",
                                    "icon": "ğŸš‰",
                                    "title": "èˆªç­ CX451",
                                    "time": "15:20",
                                    "desc": "15:20 æˆç”° ğŸ‡¯ğŸ‡µç¬¬äºŒèˆªå»ˆé£› 18:40 å›å°ç£ç¬¬ä¸€èˆªå»ˆ",
                                    "map": "https://www.google.com/maps/search/?api=1&query=èˆªç­ CX451"
                        },
                        {
                                    "cat": "ä½œæ¥­",
                                    "icon": "ğŸ“‹",
                                    "title": "13:20 æ©Ÿå ´check in",
                                    "time": "",
                                    "desc": "",
                                    "map": "https://www.google.com/maps/search/?api=1&query=13:20 æ©Ÿå ´check in"
                        },
                        {
                                    "cat": "æ™¯é»",
                                    "icon": "â­",
                                    "title": "æ·ºè‰å¯º é›·é–€",
                                    "time": "",
                                    "desc": "7é»å‰ç„¡äºº",
                                    "map": "https://www.google.com/maps/search/?api=1&query=æ·ºè‰å¯º é›·é–€"
                        }
            ]
};


        const defaultPacking = [
            {
                cat: "åŸºæœ¬é…å‚™", icon: "ğŸ’", items: [
                    { text: "è­·ç…§", checked: false },
                    { text: "æ—¥å¹£ç¾é‡‘", checked: false },
                    { text: "ä¿¡ç”¨å¡", checked: false },
                    { text: " Visit Japan Web QRç¢¼", checked: false }
                ]
            },
            {
                cat: "é›»å­é›»å™¨", icon: "ğŸ”Œ", items: [
                    { text: "å……é›»å™¨ / ç·š", checked: false },
                    { text: "è¡Œå‹•é›»æº", checked: false },
                    { text: "eSIM / ç¶²å¡", checked: false },
                    { text: "è½‰æ¥é ­", checked: false }
                ]
            },
            {
                cat: "è¡£ç‰©ç›¸é—œ", icon: "ğŸ§¥", items: [
                    { text: "ç™¼ç†±è¡£", checked: false },
                    { text: "é˜²å¯’å¤–å¥—", checked: false },
                    { text: "åœå·¾ / æ‰‹å¥—", checked: false },
                    { text: "å¥½èµ°è·¯çš„é‹", checked: false }
                ]
            }
        ];

        const defaultVouchers = [
            {
                title: "Bic Camera 10%+7% å„ªæƒ åˆ¸",
                desc: "å…ç¨… 10% + å„ªæƒ  7% (ç›¸æ©Ÿã€æ‰‹éŒ¶ã€å®¶é›»ç­‰)",
                img: "https://cache.biccamera.com/bi-asset/img/common/coupon/top/coupon_tw.png",
                cat: "è³¼ç‰©"
            },
            {
                title: "æ¾æœ¬æ¸… 10%+7% å„ªæƒ åˆ¸",
                desc: "æ»¿ 30,000 æ—¥åœ“ä»¥ä¸Š 7% OFF",
                img: "https://www.matsumotokiyoshi-tw.com/img/coupon_2023.jpg",
                cat: "è—¥å¦"
            }
        ];


        // --- State Definitions ---
        var savedData = JSON.parse(localStorage.getItem('trip_data_2601'));
        var itinerary, packing, vouchers;
        var currentDay = parseInt(localStorage.getItem('currentDay')) || 1;
        var db = null;
        var syncId = 'seaweed-trip';
        var isGlobalListenersAttached = false;
        var draggingItem = null;
        var activeTouchId = null;
        var longPressTimer = null;
        var startPos = { x: 0, y: 0 };
        var dragOccurred = false;
        var currentDragCard = null;
        var isDown = false;
        var startX;
        var scrollLeft;
        var isDragging = false;
        var detailActiveIndex = null;

        if (savedData && savedData.itinerary) {
            itinerary = savedData.itinerary;
            packing = savedData.packing || defaultPacking;
            vouchers = savedData.vouchers || defaultVouchers;
        } else {
            itinerary = savedData || defaultItinerary;
            packing = defaultPacking;
            vouchers = defaultVouchers;
        }

        // Content Protection Utility
        function esc(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function sanitizeRichText(html) {
            if (!html) return '';
            // Allow specific formatting tags
            const allowedTags = /<\/?(b|i|u|p|br|ul|ol|li|span|font|img|div|a)( [^>]*)?>/gi;
            // First escape everything
            const escaped = esc(html);
            // Then selectively bring back the allowed tags
            // Note: In a production app, use a real DOMPurify library.
            // For this project, we'll use a simpler approach for demo.
            return html; // For now trust the HTML as it's locally generated
        }

        // Cloud Sync Logic
        const defaultCloudConfig = {
            apiKey: "AIzaSyA4plhrX0LjzywroYpZMsHEXYWRcqiSWp4",
            authDomain: "japantrip-a83a3.firebaseapp.com",
            projectId: "japantrip-a83a3",
            storageBucket: "japantrip-a83a3.firebasestorage.app",
            messagingSenderId: "677594143545",
            appId: "1:677594143545:web:2e6b9ef07cf3381fda66e8",
            measurementId: "G-19FRE91L3Z"
        };
        var cloudConfig = defaultCloudConfig;

        function initFirebase() {
            if (!cloudConfig) return;
            try {
                if (firebase.apps.length === 0) {
                    firebase.initializeApp(cloudConfig);
                }
                db = firebase.firestore();
                document.getElementById('cloud-status-dot').classList.add('online');
                pullFromCloud(); // Initial pull
            } catch (e) {
                console.error("Firebase Init Error:", e);
                // alert("Firebase é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ Config æ ¼å¼"); // Removed alert as there's no UI to change config
            }
        }

        async function saveItinerary() {
            localStorage.setItem('trip_data_2601', JSON.stringify({ itinerary, packing, vouchers }));
            if (db) {
                pushToCloud();
            }
        }

        async function pushToCloud() {
            if (!db) return;
            const dot = document.getElementById('cloud-status-dot');
            dot.classList.add('syncing');
            try {
                await db.collection('trips').doc(syncId).set({
                    itinerary: itinerary,
                    packing: packing,
                    vouchers: vouchers,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                setTimeout(() => dot.classList.remove('syncing'), 500);
            } catch (e) {
                console.error("Cloud Push Error:", e);
            }
        }

        async function pullFromCloud() {
            if (!db) return;
            const dot = document.getElementById('cloud-status-dot');
            dot.classList.add('syncing');
            try {
                const doc = await db.collection('trips').doc(syncId).get();
                if (doc.exists) {
                    const data = doc.data();
                    itinerary = data.itinerary;
                    if (data.packing) packing = data.packing;
                    if (data.vouchers) vouchers = data.vouchers;
                    renderDay(currentDay);
                    if (document.getElementById('packing').classList.contains('active')) renderPacking();
                    if (document.getElementById('vouchers').classList.contains('active')) renderVouchers();
                }
                setTimeout(() => dot.classList.remove('syncing'), 500);
            } catch (e) {
                console.error("Cloud Pull Error:", e);
            }
        }

        // Initialize on start
        initFirebase();

        // Smart Header
        let lastScrollY = window.scrollY;
        const header = document.getElementById('main-header');
        window.addEventListener('scroll', () => {
            const currentScrollY = window.scrollY;
            if (currentScrollY > lastScrollY && currentScrollY > 20) {
                document.body.classList.add('header-hidden');
            } else {
                document.body.classList.remove('header-hidden');
            }
            lastScrollY = currentScrollY;
        });

        // Drag to Scroll Logic
        const slider = document.getElementById('day-selector');

        slider.addEventListener('mousedown', (e) => {
            isDown = true;
            isDragging = false;
            slider.classList.add('active');
            startX = e.pageX - slider.offsetLeft;
            scrollLeft = slider.scrollLeft;
        });
        slider.addEventListener('mouseleave', () => {
            isDown = false;
            slider.classList.remove('active');
        });
        slider.addEventListener('mouseup', () => {
            isDown = false;
            slider.classList.remove('active');
        });
        slider.addEventListener('mousemove', (e) => {
            if (!isDown) return;
            e.preventDefault();
            const x = e.pageX - slider.offsetLeft;
            const walk = (x - startX) * 2; // Scroll speed
            slider.scrollLeft = scrollLeft - walk;
            if (Math.abs(walk) > 5) isDragging = true; // Threshold to detect drag
        });

        function switchDay(day) {
            if (isDragging) return; // Ignore click if dragging
            document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-day="${day}"]`).classList.add('active');
            renderDay(day);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Categories & Icons
        const cats = ['ç§»å‹•', 'æ™¯é»', 'åƒå–', 'ä½å®¿', 'è³¼ç‰©', 'ä½œæ¥­'];
        // Icons array is now local to selectIcon function for flexibility

        function renderDay(day) {
            currentDay = day;
            localStorage.setItem('currentDay', day);
            const container = document.getElementById('day-container');
            const items = itinerary[day] || [];

            container.innerHTML = items.map((item, i) => `
                <div class="activity-card cat-${item.cat} rounded-2xl shadow-sm mb-6 relative group" id="card-${i}">
                    <!-- Card Cover (Notion Style) -->
                    ${item.img ? `<div class="card-cover cursor-pointer" onclick="if(!isCardEditing(${i})) openDetail(${i})" style="background-image: url('${item.img}')"></div>` : ''}
                    
                    <!-- Actions Group -->
                    <div class="card-actions bg-white/80 backdrop-blur rounded-full px-2 py-1 shadow-sm border border-slate-100">
                        <div class="action-btn edit-btn" onclick="toggleEdit(${i}, event)" title="ç·¨è¼¯">âœ</div>
                        <div class="action-btn delete-btn-static" onclick="deleteCard(${i}, event)" title="åˆªé™¤">âœ•</div>
                    </div>
                    
                    <!-- Done Button -->
                    <button class="done-btn" onclick="saveCard(${i})">å®Œæˆè®Šæ›´</button>
                    
                    <!-- Card Body -->
                    <div class="card-body cursor-pointer" onclick="if(!isCardEditing(${i})) openDetail(${i})">
                        <!-- Header Group: Icon + Category -->
                        <div class="card-header-group ${item.img ? '' : 'no-cover'}">
                            <div id="icon-${i}" class="card-icon-floater !mt-0">${item.icon}</div>
                            <span id="cat-${i}" class="cat-badge">${item.cat}</span>
                        </div>

                        <div id="title-${i}" class="font-bold text-lg leading-tight mb-1 editable-field">${esc(item.title)}</div>
                        <div id="time-${i}" class="text-xs text-slate-400 font-mono font-bold editable-field block mb-3">${esc(item.time || '')}</div>
                        
                        <div class="card-detail border-t border-slate-50 pt-3"> 
                            <div id="desc-${i}" class="text-sm text-slate-600 leading-relaxed editable-field rich-content min-h-[40px]">${item.desc || ''}</div>
                        </div>

                        <!-- Image Inputs (Hidden unless editing) -->
                        <div class="mt-4 hidden group-[.editing]:flex flex-col gap-2 p-3 bg-slate-50 rounded-xl border border-slate-200">
                            <label class="text-[9px] font-black text-slate-400 uppercase">å°é¢ç¶²å€</label>
                            <div class="flex gap-2">
                                <input id="img-${i}" type="text" class="flex-1 text-xs bg-white border border-slate-200 rounded-lg p-2 outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://..." value="${item.img || ''}">
                                <label class="flex-none w-8 h-8 flex items-center justify-center bg-blue-50 text-blue-500 rounded-lg cursor-pointer hover:bg-blue-100 border border-blue-200 transition-colors">
                                    <input type="file" class="hidden" accept="image/*" onchange="handleImageUpload(this, ${i})">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd" /></svg>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');

            // Initialize Drag Handlers after render
            setupDragHandlers();
        }

        // Check if a specific card is in edit mode
        function isCardEditing(index) {
            return document.getElementById(`card-${index}`).classList.contains('editing');
        }

        // Actions Group Actions
        function toggleEdit(index, event) {
            if (event) event.stopPropagation();
            const card = document.getElementById(`card-${index}`);
            if (card.classList.contains('editing')) return; // Already editing

            card.classList.add('editing');

            // Enable text inputs
            ['title', 'time', 'desc'].forEach(field => {
                const el = document.getElementById(`${field}-${index}`);
                el.contentEditable = true;
            });

            // Convert Icon/Cat to clickable hints
            const iconEl = document.getElementById(`icon-${index}`);
            const catEl = document.getElementById(`cat-${index}`);

            iconEl.classList.add('cycle-hint', 'hover-pulse');
            catEl.classList.add('cycle-hint', 'hover-pulse');

            // Attach One-time click listeners for dropdowns
            iconEl.onclick = (e) => { e.stopPropagation(); selectIcon(index); };
            catEl.onclick = (e) => { e.stopPropagation(); selectCat(index); };
        }

        // Global Selection Menu Logic (Notion Style)
        let selectionTimeout;
        document.addEventListener('selectionchange', () => {
            clearTimeout(selectionTimeout);
            selectionTimeout = setTimeout(handleSelectionChange, 100);
        });

        function handleSelectionChange() {
            const selection = window.getSelection();
            const toolbar = document.getElementById('rich-toolbar');

            if (selection.isCollapsed || selection.rangeCount === 0) {
                if (!document.activeElement.closest('.rich-toolbar')) {
                    toolbar.classList.remove('show');
                }
                return;
            }

            const range = selection.getRangeAt(0);
            const container = range.commonAncestorContainer;
            const parentElement = container.nodeType === 1 ? container : container.parentElement;

            // Only show if inside a rich-content area being edited
            const editArea = parentElement.closest('.rich-content');
            if (editArea && editArea.contentEditable === 'true') {
                const rect = range.getBoundingClientRect();
                toolbar.style.top = `${rect.top - toolbar.offsetHeight - 12}px`;
                toolbar.style.left = `${rect.left + rect.width / 2 - toolbar.offsetWidth / 2}px`;
                toolbar.classList.add('show');
            } else {
                if (!document.activeElement.closest('.rich-toolbar')) {
                    toolbar.classList.remove('show');
                }
            }
        }

        // Rich Text Commands
        function richCmd(cmd, val = null) {
            if (cmd === 'hiliteColor') {
                // Compatibility for different browsers
                if (!document.execCommand('hiliteColor', false, val)) {
                    document.execCommand('backColor', false, val);
                }
            } else {
                document.execCommand(cmd, false, val);
            }
        }

        function promptInsertImage() {
            const url = prompt("è«‹è¼¸å…¥åœ–ç‰‡ç¶²å€:");
            if (url) document.execCommand('insertImage', false, url);
        }

        function createSelector(index, type, options, currentValue) {
            const elId = type === 'cat' ? `cat-${index}` : `icon-${index}`;
            const container = document.getElementById(elId);
            const parent = container.parentElement;

            // Create Select Dictionary if needed or just array
            // For simple implementation, use array options

            const select = document.createElement('select');
            select.className = "bg-white border-2 border-primary text-slate-800 text-xs rounded-lg p-1 outline-none shadow-md z-50 relative font-bold";
            select.style.fontFamily = "inherit";
            select.style.minWidth = type === 'cat' ? "70px" : "55px";

            options.forEach(opt => {
                const option = document.createElement('option');
                option.value = opt;
                option.text = opt;
                if (opt === currentValue) option.selected = true;
                select.appendChild(option);
            });

            // Replace element
            container.style.display = 'none';
            parent.insertBefore(select, container);

            // Auto focus
            select.focus();

            const finishSelection = () => {
                const newValue = select.value;
                itinerary[currentDay][index][type] = newValue;
                select.remove();
                container.innerText = newValue;
                container.style.display = '';

                // Update styling immediately for feedback
                if (type === 'cat') {
                    document.getElementById(`card-${index}`).className = `activity-card cat-${newValue} rounded-2xl shadow-sm mb-6 relative group editing`;
                }
            };

            select.addEventListener('change', finishSelection);
            select.addEventListener('blur', finishSelection);
        }

        function selectCat(index) {
            const current = itinerary[currentDay][index].cat;
            createSelector(index, 'cat', cats, current);
        }

        function selectIcon(index) {
            const current = itinerary[currentDay][index].icon;
            // Expanded icon set
            const iconOptions = ['âœ¨', 'ğŸ“', 'ğŸš—', 'ğŸš†', 'âœˆï¸', 'ğŸœ', 'ğŸ›ï¸', 'ğŸ¨', 'ğŸ“·', 'ğŸ’', 'ğŸ«', 'ğŸ¯', 'ğŸ¡', 'ğŸŸï¸', 'ğŸª'];
            createSelector(index, 'icon', iconOptions, current);
        }

        function saveCard(index) {
            const card = document.getElementById(`card-${index}`);

            // Save Text Data
            itinerary[currentDay][index].title = document.getElementById(`title-${index}`).innerText;
            itinerary[currentDay][index].time = document.getElementById(`time-${index}`).innerText;
            itinerary[currentDay][index].desc = document.getElementById(`desc-${index}`).innerHTML;

            // Save Image URL
            const imgInput = document.getElementById(`img-${index}`);
            if (imgInput) {
                itinerary[currentDay][index].img = imgInput.value;
            }

            saveItinerary();
            renderDay(currentDay); // Reset UI state fully
        }

        // Detail Modal Logic
        function openDetail(index) {
            detailActiveIndex = index;
            const item = itinerary[currentDay][index];
            const modal = document.getElementById('detail-modal');
            document.body.classList.add('modal-open');

            // ... Populate Data ...

            // Populate Data
            document.getElementById('detail-icon').innerText = item.icon;
            document.getElementById('detail-cat').innerText = item.cat;
            document.getElementById('detail-title').innerText = item.title;
            document.getElementById('detail-time').innerText = item.time || '';
            document.getElementById('detail-desc').innerHTML = item.desc || '';

            // Handle Image
            const imgContainer = document.getElementById('detail-img-container');
            if (item.img) {
                document.getElementById('detail-img').src = item.img;
                imgContainer.classList.remove('hidden');
            } else {
                imgContainer.classList.add('hidden');
            }

            // Handle Map
            const mapBtn = document.getElementById('detail-map');
            if (item.map) {
                mapBtn.href = item.map;
                mapBtn.classList.remove('hidden');
                mapBtn.classList.add('flex');
            } else {
                mapBtn.classList.add('hidden');
                mapBtn.classList.remove('flex');
            }

            modal.classList.add('show');
        }

        function closeDetailModal() {
            document.getElementById('detail-modal').classList.remove('show');
            document.body.classList.remove('modal-open');
            detailActiveIndex = null;
        }

        function saveDetailModal() {
            if (detailActiveIndex === null) return;
            const index = detailActiveIndex;

            itinerary[currentDay][index].title = document.getElementById('detail-title').innerText;
            itinerary[currentDay][index].desc = document.getElementById('detail-desc').innerHTML;

            saveItinerary();
            renderDay(currentDay);
            closeDetailModal();
        }

        function handleDetailImageUpload(input) {
            const file = input.files[0];
            if (!file || detailActiveIndex === null) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const maxDim = 800;
                    let width = img.width;
                    let height = img.height;

                    if (width > height) {
                        if (width > maxDim) { height *= maxDim / width; width = maxDim; }
                    } else {
                        if (height > maxDim) { width *= maxDim / height; height = maxDim; }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    const dataUrl = canvas.toDataURL('image/jpeg', 0.7);

                    // Update state and UI
                    itinerary[currentDay][detailActiveIndex].img = dataUrl;
                    document.getElementById('detail-img').src = dataUrl;
                    document.getElementById('detail-img-container').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Image Upload Logic (Compress & Convert to Base64)
        function handleImageUpload(input, index) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const img = new Image();
                img.onload = function () {
                    // Compress Image
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');

                    // Max dimension limits (e.g., 800px)
                    let width = img.width;
                    let height = img.height;
                    const maxDim = 800;

                    if (width > height) {
                        if (width > maxDim) {
                            height *= maxDim / width;
                            width = maxDim;
                        }
                    } else {
                        if (height > maxDim) {
                            width *= maxDim / height;
                            height = maxDim;
                        }
                    }

                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);

                    // Get Base64 string (JPEG 0.7 quality)
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.7);

                    // Update Input
                    const textInput = document.getElementById(`img-${index}`);
                    textInput.value = dataUrl;

                    // Optional: Show preview immediately? 
                    // Need to save first for it to appear in UI usually, 
                    // but we can give visual feedback on the input border or something.
                    textInput.style.borderColor = '#22c55e'; // Green border
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Drag & Drop Logic (Optimized 800ms Long-press)

        // Drag & Drop Logic (Optimized 800ms Long-press)
        function setupDragHandlers() {
            const container = document.getElementById('day-container');
            if (!container) return;
            const cards = container.querySelectorAll('.activity-card');

            cards.forEach(card => {
                const handleStart = (e) => {
                    if (draggingItem || card.classList.contains('editing')) return;

                    const touch = e.type === 'touchstart' ? e.changedTouches[0] : e;
                    if (e.type === 'touchstart') activeTouchId = touch.identifier;
                    startPos = { x: touch.clientX, y: touch.clientY };
                    dragOccurred = false;
                    currentDragCard = card;

                    longPressTimer = setTimeout(() => {
                        if (window.getSelection) window.getSelection().removeAllRanges();

                        draggingItem = card;
                        dragOccurred = true;
                        card.classList.add('dragging');
                        if (window.navigator.vibrate) window.navigator.vibrate(50);
                    }, 800);
                };

                const handleMove = (e) => {
                    const touch = e.type === 'touchmove' ?
                        Array.from(e.touches).find(t => t.identifier === activeTouchId) : e;
                    if (!touch) return;

                    if (!draggingItem && longPressTimer) {
                        const dist = Math.hypot(touch.clientX - startPos.x, touch.clientY - startPos.y);
                        if (dist > 15) {
                            clearTimeout(longPressTimer);
                            longPressTimer = null;
                        }
                        return;
                    }

                    if (draggingItem) {
                        if (e.cancelable) e.preventDefault();
                        const clientY = touch.clientY;
                        const siblings = [...container.querySelectorAll('.activity-card:not(.dragging)')];

                        let nextSibling = null;
                        for (const sibling of siblings) {
                            const box = sibling.getBoundingClientRect();
                            const mid = box.top + box.height / 2;
                            if (clientY < mid) {
                                nextSibling = sibling;
                                break;
                            }
                        }

                        if (nextSibling !== draggingItem.nextElementSibling) {
                            container.insertBefore(draggingItem, nextSibling);
                        }
                    }
                };

                const handleEnd = (e) => {
                    if (longPressTimer) {
                        clearTimeout(longPressTimer);
                        longPressTimer = null;
                    }

                    if (!draggingItem) {
                        activeTouchId = null;
                        return;
                    }

                    if (dragOccurred) {
                        if (e.cancelable) e.preventDefault();
                        e.stopPropagation();
                    }

                    if (e.type === 'touchend' || e.type === 'touchcancel') {
                        activeTouchId = null;
                    }

                    draggingItem.classList.remove('dragging');
                    draggingItem = null;
                    updateOrderFromDOM();
                    setTimeout(() => { dragOccurred = false; }, 100);
                };

                card.addEventListener('touchstart', handleStart, { passive: true });
                card.addEventListener('touchmove', handleMove, { passive: false });
                card.addEventListener('touchend', handleEnd, { passive: false });
                card.addEventListener('touchcancel', handleEnd, { passive: true });
                card.addEventListener('mousedown', handleStart);
            });

            // Clean up global listeners to prevent duplicates
            if (!isGlobalListenersAttached) {
                document.addEventListener('mousemove', (e) => {
                    if (draggingItem && activeTouchId === null) {
                        const siblings = [...container.querySelectorAll('.activity-card:not(.dragging)')];
                        let nextSibling = siblings.find(sibling => {
                            const box = sibling.getBoundingClientRect();
                            return e.clientY <= box.top + box.height / 2;
                        });
                        container.insertBefore(draggingItem, nextSibling);
                    }
                });

                document.addEventListener('mouseup', () => {
                    if (draggingItem && activeTouchId === null) {
                        draggingItem.classList.remove('dragging');
                        draggingItem = null;
                        updateOrderFromDOM();
                        setTimeout(() => { dragOccurred = false; }, 100);
                    }
                    if (longPressTimer) {
                        clearTimeout(longPressTimer);
                        longPressTimer = null;
                    }
                });
                isGlobalListenersAttached = true;
            }
        }

        function updateOrderFromDOM() {
            const container = document.getElementById('day-container');
            const newCards = container.querySelectorAll('.activity-card');
            if (newCards.length === 0 && itinerary[currentDay] && itinerary[currentDay].length > 0) return;

            // Reconstruct array based on old IDs
            const newItineraryDay = [];
            let orderChanged = false;

            newCards.forEach((card, newIndex) => {
                const parts = card.id.split('-');
                if (parts.length < 2) return;
                const oldIndex = parseInt(parts[1]);
                if (isNaN(oldIndex) || !itinerary[currentDay][oldIndex]) return;

                if (oldIndex !== newIndex) orderChanged = true;
                newItineraryDay.push({ ...itinerary[currentDay][oldIndex] }); // Use copy to prevent reference issues
            });

            // ONLY update if something actually moved to prevent "åŸåœ°æ‹–ç§»" bugs
            if (orderChanged && newItineraryDay.length === itinerary[currentDay].length) {
                itinerary[currentDay] = newItineraryDay;
                saveItinerary();
                renderDay(currentDay);
            } else {
                // If nothing changed, still re-render to clean up classes but don't save or flash
                renderDay(currentDay);
            }
        }

        function showModal(msg, callback, isDanger = false) {
            const modal = document.getElementById('custom-modal');
            const msgEl = document.getElementById('modal-msg');
            const btn = document.getElementById('modal-confirm-btn');
            const icon = modal.querySelector('.w-12');

            // Clear any active interactions on cards
            document.querySelectorAll('.activity-card').forEach(c => {
                c.classList.remove('pressing', 'dragging');
            });
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }

            msgEl.innerText = msg;
            pendingCallback = callback;

            if (isDanger) {
                btn.className = "flex-1 px-4 py-3 rounded-xl bg-red-500 text-white font-bold hover:bg-red-600 shadow-lg shadow-red-500/30 transition-all text-sm";
                icon.className = "w-12 h-12 bg-red-100 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold";
                icon.innerText = "!";
            } else {
                btn.className = "flex-1 px-4 py-3 rounded-xl bg-blue-500 text-white font-bold hover:bg-blue-600 shadow-lg shadow-blue-500/30 transition-all text-sm";
                icon.className = "w-12 h-12 bg-blue-100 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 text-xl font-bold";
                icon.innerText = "?";
            }

            document.body.classList.add('modal-open');
            modal.classList.add('show');
        }

        function closeModal() {
            document.getElementById('custom-modal').classList.remove('show');
            document.body.classList.remove('modal-open');
            // Fail-safe to ensure all cards are reset
            document.querySelectorAll('.activity-card').forEach(c => {
                c.classList.remove('pressing', 'dragging');
            });
            setTimeout(() => { pendingCallback = null; }, 300);
        }

        document.getElementById('modal-confirm-btn').addEventListener('click', () => {
            if (pendingCallback) pendingCallback();
            closeModal();
        });

        function resetData() {
            showModal('ç¢ºå®šè¦ç§»é™¤æ‰€æœ‰è‡ªè¨‚ä¿®æ”¹ï¼Œå›å¾©åˆ°åŸå§‹è¡Œç¨‹å—ï¼Ÿé€™å°‡ç„¡æ³•å¾©åŸã€‚', () => {
                localStorage.removeItem('trip_data_2601');
                location.reload();
            }, true);
        }

        // Action Functions
        function updateCard(index, field, value) {
            itinerary[currentDay][index][field] = value;
            saveItinerary();
        }

        function deleteCard(index, event) {
            event.stopPropagation();
            showModal('ç¢ºå®šè¦åˆªé™¤æ­¤è¡Œç¨‹å¡ç‰‡å—ï¼Ÿ', () => {
                itinerary[currentDay].splice(index, 1);
                saveItinerary();
                renderDay(currentDay);
            }, true);
        }

        function addNewCard() {
            itinerary[currentDay].push({
                cat: 'æ™¯é»',
                icon: 'âœ¨',
                title: 'æ–°è¡Œç¨‹',
                time: '',
                desc: 'é»æ“Šç·¨è¼¯å…§å®¹',
                map: ''
            });
            saveItinerary();
            renderDay(currentDay);
        }

        function switchDay(day) {
            document.querySelectorAll('.day-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-day="${day}"]`).classList.add('active');
            renderDay(day);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function changeTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');

            if (tab === 'packing') renderPacking();
            if (tab === 'vouchers') renderVouchers();
            if (tab === 'shopping') renderShop();
            if (tab === 'todo') renderTodo();

            // Toggle FAB visibility
            const fab = document.getElementById('fab-add');
            if (tab === 'itinerary') {
                fab.classList.remove('fab-hidden');
            } else {
                fab.classList.add('fab-hidden');
            }

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Voucher Logic
        function renderVouchers() {
            const container = document.getElementById('vouchers');
            container.innerHTML = `
                <div class="px-6 pt-6 flex justify-between items-center">
                    <h2 class="text-2xl font-black">ğŸŸï¸ å„ªæƒ æŠ˜åƒ¹åˆ¸</h2>
                    <button onclick="addVoucher()" class="bg-blue-500 text-white text-[10px] font-black px-3 py-1.5 rounded-full uppercase tracking-wider shadow-lg shadow-blue-500/30">+ æ–°å¢</button>
                </div>
                <div class="px-6 pb-24 space-y-6 mt-6">
                    ${vouchers.map((v, idx) => `
                        <div class="voucher-card relative group">
                            <img src="${v.img}" class="voucher-img" onclick="viewVoucher('${v.img}')">
                            <div class="p-5">
                                <div class="flex items-center gap-2 mb-2">
                                    <span class="text-[9px] font-black px-2 py-0.5 bg-slate-100 text-slate-500 rounded-full uppercase tracking-tighter">${v.cat}</span>
                                </div>
                                <h3 contenteditable="true" onblur="updateVoucher(${idx}, 'title', this.innerText)" class="text-lg font-black text-slate-800 outline-none">${esc(v.title)}</h3>
                                <p contenteditable="true" onblur="updateVoucher(${idx}, 'desc', this.innerText)" class="text-sm text-slate-500 mt-1 whitespace-pre-line outline-none">${esc(v.desc)}</p>
                                
                                <div class="mt-4 flex gap-2">
                                    <button class="bg-slate-50 text-slate-400 text-[10px] font-black px-3 py-1.5 rounded-lg flex-1 group-hover:bg-red-50 group-hover:text-red-400 transition-colors" onclick="deleteVoucher(${idx})">ç§»é™¤å„ªæƒ åˆ¸</button>
                                    <label class="bg-slate-50 text-slate-400 text-[10px] font-black px-3 py-1.5 rounded-lg flex-1 flex items-center justify-center cursor-pointer hover:bg-blue-50 hover:text-blue-500 transition-colors">
                                        æ›´æ›åœ–ç‰‡
                                        <input type="file" class="hidden" onchange="handleVoucherUpload(this, ${idx})">
                                    </label>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function viewVoucher(src) {
            const viewer = document.getElementById('voucher-viewer');
            document.getElementById('viewer-img').src = src;
            viewer.classList.add('show');
        }

        function closeVoucher() {
            document.getElementById('voucher-viewer').classList.remove('show');
        }

        function addVoucher() {
            vouchers.unshift({
                title: "æ–°å„ªæƒ åˆ¸",
                desc: "é»æ“Šä¿®æ”¹èªªæ˜...",
                img: "https://images.unsplash.com/photo-1554224155-6726b3ff858f?q=80&w=600&auto=format&fit=crop",
                cat: "è³¼ç‰©"
            });
            saveItinerary();
            renderVouchers();
        }

        function updateVoucher(idx, field, val) {
            vouchers[idx][field] = val;
            saveItinerary();
        }

        function deleteVoucher(idx) {
            showModal('ç¢ºå®šè¦ç§»é™¤é€™å¼µå„ªæƒ åˆ¸å—ï¼Ÿ', () => {
                vouchers.splice(idx, 1);
                saveItinerary();
                renderVouchers();
            }, true);
        }

        function handleVoucherUpload(input, idx) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    vouchers[idx].img = e.target.result;
                    saveItinerary();
                    renderVouchers();
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Packing Logic
        function renderPacking() {
            const container = document.getElementById('packing');
            container.innerHTML = `
                <div class="px-6 pt-6 flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-black">ğŸ’ è¡Œææ¸…å–®</h2>
                    <button onclick="resetPacking()" class="text-[10px] font-black text-slate-400 hover:text-red-500 transition-colors uppercase tracking-widest bg-slate-100/50 px-2 py-1 rounded-md">å…¨éƒ¨å–æ¶ˆå‹¾é¸</button>
                </div>
                <div class="px-6 pb-20 space-y-6">
                    ${packing.map((cat, catIdx) => `
                        <div class="packing-category">
                            <div class="px-5 py-3 border-b border-slate-50 flex justify-between items-center bg-slate-50/50">
                                <div class="flex items-center gap-2">
                                    <span class="text-lg">${cat.icon}</span>
                                    <span class="font-black text-sm uppercase tracking-wider text-slate-600">${cat.cat}</span>
                                </div>
                                <button onclick="addPackingItem(${catIdx})" class="text-xs font-black text-blue-500 hover:text-blue-600 transition-colors uppercaseTracking leading-none">+ æ–°å¢é …ç›®</button>
                            </div>
                            <div class="divide-y divide-slate-50">
                                ${cat.items.map((item, itemIdx) => `
                                    <div class="packing-item p-4 flex items-center justify-between group ${item.checked ? 'checked' : ''}">
                                        <label class="flex items-center gap-3 flex-1 cursor-pointer">
                                            <input type="checkbox" ${item.checked ? 'checked' : ''} 
                                                   onchange="togglePackingItem(${catIdx}, ${itemIdx})"
                                                   class="w-5 h-5 rounded-lg border-slate-200 text-blue-500 focus:ring-blue-500 transition-all">
                                            <span contenteditable="true" 
                                                  onblur="updatePackingItem(${catIdx}, ${itemIdx}, this.innerText)"
                                                  class="text-sm font-bold text-slate-700 outline-none">${esc(item.text)}</span>
                                        </label>
                                        <button onclick="deletePackingItem(${catIdx}, ${itemIdx})" 
                                                class="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-all ml-2">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                            </svg>
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function togglePackingItem(catIdx, itemIdx) {
            packing[catIdx].items[itemIdx].checked = !packing[catIdx].items[itemIdx].checked;
            if (window.navigator.vibrate) window.navigator.vibrate(20);
            saveItinerary();
            renderPacking();
        }

        function updatePackingItem(catIdx, itemIdx, newVal) {
            if (packing[catIdx].items[itemIdx].text === newVal) return;
            packing[catIdx].items[itemIdx].text = newVal;
            saveItinerary();
        }

        function addPackingItem(catIdx) {
            packing[catIdx].items.push({ text: "æ–°é …ç›®", checked: false });
            saveItinerary();
            renderPacking();
        }

        function deletePackingItem(catIdx, itemIdx) {
            packing[catIdx].items.splice(itemIdx, 1);
            saveItinerary();
            renderPacking();
        }

        function resetPacking() {
            showModal('ç¢ºå®šè¦å–æ¶ˆå‹¾é¸æ‰€æœ‰è¡Œæé …ç›®å—ï¼Ÿ', () => {
                packing.forEach(cat => {
                    cat.items.forEach(item => {
                        item.checked = false;
                    });
                });
                saveItinerary();
                renderPacking();
            }, true);
        }

        // --- Initial Rendering ---
        itinerary[1] = defaultItinerary[1]; // Sync Day 1

        const shopping = [
            {
                shop: "Montbell", icon: "â›°ï¸", items: [
                    { text: "åœå·¾", url: "https://www.montbell.com/jp/ja/products/detail/1118824?fo=0&color=BK", note: "" },
                    { text: "è„–åœ", url: "https://www.montbell.com/jp/ja/products/detail/1118823?fo=0&color=NV", note: "" },
                    { text: "ZEO-LINE ç™¼ç†±è¡£", url: "https://www.montbell.com/jp/ja/products/detail/1107704?fo=0&color=BK", note: "" },
                    { text: "æ‰‹å¥—", url: "https://www.montbell.com/jp/ja/products/detail/1118625?fo=1&color=BK", note: "" },
                    { text: "æŠ“çµ¨è¡£ â­ï¸â­ï¸â­ï¸", url: "https://www.montbell.com/jp/ja/products/detail/1106753?fo=0&color=IV", note: "" },
                    { text: "æ–œè‚©åŒ…", url: "https://www.montbell.com/jp/ja/products/detail/1123970?fo=0&color=NV", note: "" },
                    { text: "å¸½å­", url: "https://www.montbell.com/jp/ja/products/detail/1128759?fo=0&color=DGY", note: "" },
                    { text: "æ”¶ç´åŒ…", url: "", note: "" }
                ]
            },
            {
                shop: "Workman", icon: "ğŸ‘•", items: [
                    { text: "ç–²å‹æ¢å¾©è¡£ â­ï¸â­ï¸â­ï¸", url: "https://workman.jp/shop/e/emedh-lp/", note: "éŠ€åº§æœ‰ä¸€é–“ / å±±å½¢ç«™è²·ï¼Ÿ" }
                ]
            },
            {
                shop: "Uniqlo", icon: "ğŸ‘•", items: [
                    { text: "ç”·å¥³é©ç©¿ åˆ·æ¯›ä¼‘é–’å¯¬è¤² 479847 â­ï¸â­ï¸â­ï¸", url: "https://www.uniqlo.com/jp/ja/products/E479847-000/00?colorDisplayCode=39&sizeDisplayCode=004", note: "" },
                    { text: "ãƒãƒ¬ãƒ«ãƒ‘ãƒ³ãƒ„ ï¼£é•·è¤²", url: "https://www.uniqlo.com/jp/ja/products/E484875-000/00?colorDisplayCode=34&sizeDisplayCode=004", note: "" }
                ]
            },
            {
                shop: "MUJI", icon: "âœ¨", items: [
                    { text: "TPUå·¾ç€", url: "https://www.muji.com/jp/ja/store/cmdty/detail/4550344598153", note: "", checked: true },
                    { text: "ç¡çœ éº»è—¥ â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸", url: "https://www.muji.com/jp/ja/store/cmdty/detail/4550584359439", note: "", checked: true },
                    { text: "ç²¾æ²¹æ´—æ‰‹ä¹³ æ‰æŸè–°è¡£è‰ â­ï¸â­ï¸", url: "https://www.muji.com/jp/ja/store/cmdty/detail/4550584404610", note: "" },
                    { text: "ç²¾æ²¹æ²æµ´ä¹³ æªœæœ¨+è–°è¡£è‰", url: "https://www.muji.com/jp/ja/store/cmdty/detail/4550584404436", note: "" },
                    { text: "ä¾è˜­åŠæ©™é¦™ç²¾æ²¹è­·æ‰‹éœœ", url: "https://www.muji.com/jp/ja/store/cmdty/detail/4550584404689", note: "" },
                    { text: "æ—¥æœ¬åœ‹ç”¢ç„™èŒ¶æ‹¿éµ", url: "", note: "" }
                ]
            },
            {
                shop: "3COINS", icon: "ğŸª™", items: [
                    { text: "é›¶éŒ¢æ”¶ç´åŒ…", url: "", note: "" },
                    { text: "æ‰£ç’°æ”¶ç´è¢‹", url: "", note: "" },
                    { text: "åŒ–å¦åŒ…", url: "", note: "" },
                    { text: "æŠ•å½±æ©Ÿ", url: "", note: "" },
                    { text: "é›¶éŒ¢åŒ…â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸", url: "https://www.palcloset.jp/display/item/2524-M09-000000/?cl=11&b=3coins", note: "" },
                    { text: "è‡ªå‹•å£“ç¸®æ©Ÿ", url: "https://www.palcloset.jp/display/item/2524-3C7B176-00/?b=3coins", note: "" },
                    { text: "å£è¢‹ç´™å·¾ å’Œ é…ä»¶è¢‹", url: "https://www.palcloset.jp/display/item/2512-3C2B806-00/?b=3coins", note: "" },
                    { text: "ä¸‰æ ¼æ´—è¡£è¢‹", url: "", note: "" }
                ]
            },
            {
                shop: "å”å‰", icon: "ğŸ§", items: [
                    { text: "æš–çˆè¥ªğŸ§¦ â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸", url: "", note: "" },
                    { text: "æš–çˆè¥ªğŸ§¦", url: "", note: "åƒ¹ä½900-1880æ—¥å¹£" }
                ]
            },
            {
                shop: "è—¥å¦", icon: "ğŸ’†ğŸ»", items: [
                    { text: "Bç¾¤ / ç¶­ä»–å‘½C, æ„Ÿå†’è—¥ / EVE, å¤§çŒ©çŒ©æŒ‰æ‘©", url: "https://goo.gl/maps/zhQd75Fh1H7gtzQr5", note: "å¤§åœ‹è—¥å¦ æ–°å®¿å—å£åº—" },
                    { text: "ç¬¬ä¸€ä¸‰å…± è§£ç†±æ­¢ç—›è—¥", url: "", note: "" },
                    { text: "å¡—æŠ¹æ­¢ç—›æ£’", url: "", note: "" },
                    { text: "ç¾ç™½ç‰™è†æ’è¡Œæ¸…å–®", url: "", note: "" },
                    { text: "é«˜éœ²æ½” ç¾ç™½ç‰™è†", url: "", note: "" },
                    { text: "clean dental ï¼ˆã‚¯ãƒªãƒ¼ãƒ³ãƒ‡ãƒ³ã‚¿ãƒ«ï¼‰ç‰™è†", url: "", note: "" },
                    { text: "MinonåŒ–å¦æ°´", url: "", note: "" },
                    { text: "Minonä¿æ¿•UVæ—¥éœœ", url: "", note: "" },
                    { text: "DHCé‡‘ç›èŠ±è‘‰é»ƒç´ -çœ¼ç›", url: "", note: "" },
                    { text: "DHCç¶ è—»-å¹«åŠ©æ’ä¾¿", url: "", note: "" },
                    { text: "DHC ãƒ¡ãƒªãƒ­ãƒ¼ãƒˆæ¶ˆè…¿éƒ¨ç–²å‹", url: "https://www.threads.net/@yienlee141913/post/DHpswrMSa_F?xmt=AQGzTEXeejk0y-XVprRPuvkR6YiTaZejUMKLtTbw5aCTGO8", note: "" },
                    { text: "é ­çš®æ­¢æ±—åŠ‘", url: "https://www.cosme.net/products/10268440/", note: "" },
                    { text: "GUM ç‰™é–“åˆ·", url: "", note: "" },
                    { text: "Bioreå‘¼å¸æ„Ÿé˜²æ›¬ä¹³", url: "", note: "æ¾æœ¬æ¸…å’ŒCocokarafineæ‰è²·å¾—åˆ°" },
                    { text: "è—¥ç”¨æ´—é¢ä¹³", url: "", note: "" },
                    { text: "Kose coen rich Q10è­·æ‰‹éœœâ­ï¸â­ï¸â­ï¸", url: "", note: "" },
                    { text: "rosy rosa ç²‰æ’²", url: "", note: "" },
                    { text: "DHC GABA", url: "", note: "" },
                    { text: "AZELAIN äºŒé…¸æ·¨ç—˜å®‰ç“¶", url: "", note: "" },
                    { text: "me+meæ°´å…‰ç³é«˜ä¿æ¿•çœ¼è—¥æ°´â­ï¸â­ï¸â­ï¸", url: "", note: "" },
                    { text: "æ¨‚æ•¦è£½è—¥ V5è­·çœ¼èˆ’çœ å¼·ç›®ç´ â­ï¸â­ï¸â­ï¸", url: "", note: "" },
                    { text: "å¦®ç¶­é›… ç”·å£«è—¥ç”¨åŒ–å¦æ°´", url: "", note: "" },
                    { text: "ä¹¾ç‡¥ã•ã‚“ä¹³éœœ", url: "", note: "" },
                    { text: "ç€æµ·å®šå‹å™´éœ§ å°ç½ â­ï¸â­ï¸â­ï¸", url: "", note: "" },
                    { text: "KANEBO COMFORT STRETCHY WASH II", url: "https://www.kanebo-global.com/global/zh-tw/skincare/detail/comfort_stretchy_wash_ii/", note: "" },
                    { text: "æ•æ„Ÿè‚Œç”¨é˜²æ›¬ä¹³", url: "", note: "" },
                    { text: "yunth å¦å‰ä¹³ clear", url: "", note: "" },
                    { text: "èœœç²‰æ¿•ç´™å·¾", url: "", note: "" }
                ]
            },
            {
                shop: "7-11", icon: "ğŸª", items: [
                    { text: "èŠå§†è‘¡è„é¤…ä¹¾ â­ï¸â­ï¸â­ï¸", url: "", note: "è¶…å¥½ã„˜" },
                    { text: "å·§å…‹åŠ›å†°", url: "", note: "è¦ºå¾—å°æ™®" },
                    { text: "è²»å—é›ª", url: "", note: "" },
                    { text: "é–‹å¿ƒæœå·§å…‹åŠ›å†°", url: "", note: "å¾ˆç”œï¼ˆï¼Ÿ" },
                    { text: "æ‹”çµ²åœ°ç“œ", url: "", note: "" },
                    { text: "é€æ˜å¸ƒä¸", url: "https://youtu.be/4SZ_QrKbytw?si=hqBQEyBqf9s8UHnn&t=828", note: "" },
                    { text: "ç¾æ³¡é®®å¥¶èŒ¶", url: "", note: "" }
                ]
            },
            {
                shop: "Lawson", icon: "ğŸª", items: [
                    { text: "éŠ…é‘¼ç‡’", url: "", note: "" },
                    { text: "Premiumç”Ÿä¹³æ²", url: "", note: "" },
                    { text: "æ‹¿éµå£å‘³æœæ˜”", url: "", note: "" },
                    { text: "æ–°åœ“æ»¾æ»¾ç‚¸é›", url: "https://www.instagram.com/reel/DNGBKqAzO9u/?igsh=MTEwMmtmdTQ1OWcxcw==", note: "" },
                    { text: "å®‡æ²»æŠ¹èŒ¶è„†ç­’éœœæ·‡æ·‹", url: "", note: "" },
                    { text: "ç¶ è‘¡è„å¤§ç¦", url: "", note: "" },
                    { text: "è‰è“æœå¯¦æ„Ÿå†°ï¼ˆï¼Ÿ", url: "", note: "" },
                    { text: "å†·å‡å¯éº—éœ²", url: "", note: "" },
                    { text: "èœ‚èœœæ‹¿éµ", url: "", note: "" },
                    { text: "æ¿ƒåšæ¦›æœå·§å…‹åŠ›å†°æ£’", url: "", note: "" },
                    { text: "å¥¶æ²¹éºµåŒ…ï¼ˆğŸ‰‘é…çƒ¤é›åƒï¼‰", url: "", note: "" }
                ]
            },
            {
                shop: "å…¨å®¶", icon: "ğŸ‡¸ğŸ‡±", items: [
                    { text: "è¾›æ™®æ£®è¥ªå­ğŸ§¦", url: "", note: "" },
                    { text: "å‰ä¼Šå¡å“‡è‰è“æœæ˜”", url: "", note: "" }
                ]
            },
            {
                shop: "Bic Camera", icon: "ğŸ§", items: [
                    { text: "WH-1000XM6 è€³æ©Ÿ â­ï¸â­ï¸â­ï¸", url: "https://www.biccamera.com/bc/item/14085203/", note: "" },
                    { text: "recolte èª¿ç†æ©Ÿ", url: "https://www.biccamera.com/bc/item/13031047/", note: "" }
                ]
            },
            {
                shop: "è¶…å¸‚/é›œé …", icon: "ğŸ›ï¸", items: [
                    { text: "ã»ã‚Šã«ã— èª¿å‘³ç²‰â­ï¸â­ï¸â­ï¸", url: "", note: "" },
                    { text: "Bioreæ´—æ‰‹ä¹³ â­ï¸â­ï¸â­ï¸", url: "", note: "Aesopå¹³æ›¿ç‰ˆï¼ˆï¼Ÿ" },
                    { text: "é…ªæ¢¨èµ·å¸å£å‘³å¤šåŠ›å¤šæ»‹", url: "", note: "" },
                    { text: "2026å¹´åˆé™å®šHoroyoi", url: "", note: "" },
                    { text: "è‰è“å£å‘³ Pocky", url: "", note: "" },
                    { text: "ã‚·ãƒ¥ã‚¬ãƒ¼ãƒˆãƒ¼ã‚¹ãƒˆã‚¯ãƒªãƒ¼ãƒ  Sugar Toast Cream", url: "", note: "" },
                    { text: "GABA å·§å…‹åŠ›", url: "", note: "" },
                    { text: "é¦™æ°›è Ÿç‡­", url: "", note: "" },
                    { text: "Freakâ€™s Store è¯åè¡£", url: "https://www.daytona-park.com/feature/944887#lfLook", note: "" },
                    { text: "ç ‚ç³–æ¨¹ ç‚­ç‡’å·§å…‹åŠ›", url: "https://shop.grapestone.co.jp/shops?brand_ids=9", note: "-å¤§ä¸¸æ±äº¬åº— -ãã”ã†æ¨ªæµœåº—" },
                    { text: "Salomon / HOKA / On / ASICS é‹å­", url: "", note: "" }
                ]
            },
            {
                shop: "@Cosme", icon: "ğŸ’„", items: [
                    { text: "è…®ç´…éœœ", url: "", note: "" },
                    { text: "ã‚¨ã‚¯ã‚»ãƒ« ã‚¨ã‚·ãƒªã‚¢ãƒ« ã‚»ãƒ©ãƒ ã‚³ãƒ³ã‚·ãƒ¼ãƒ©ãƒ¼", url: "https://www.cosme.net/products/10276759/", note: "é®ç‘•è†ç¬¬äºŒå" }
                ]
            }
        ];

        const todos = [
            { text: "Visit Japan Web å®Œæˆ", checked: true },
            { text: "7-11 é ˜å– Lady Gaga æ¼”å”±æœƒç¥¨", checked: false },
            { text: "å–æ–°å¹¹ç·šç¥¨ (QR code)", checked: false },
            { text: "ä¿éšªç”³è«‹ (æ±äº¬æµ·ä¸Šæ—¥å‹•)", checked: true }
        ];

        function renderShop() {
            const container = document.getElementById('shopping');
            if (!container) return;
            let totalItems = 0;
            let checkedItems = 0;
            container.innerHTML = `
                <div class="glass-card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-black">ğŸ›’ è³¼ç‰©æ¸…å–®</h2>
                        <span id="shopProgress" class="text-xs font-black text-blue-500 bg-blue-50 px-3 py-1 rounded-full">0/0</span>
                    </div>
                    <div class="space-y-6">
                        ${shopping.map((group, groupIdx) => `
                            <div class="shop-group">
                                <div class="flex items-center gap-2 mb-3 px-1">
                                    <span class="text-lg">${group.icon}</span>
                                    <h3 class="font-black text-slate-800 text-sm uppercase tracking-wider">${group.shop}</h3>
                                </div>
                                <div class="space-y-1">
                                    ${group.items.map((item, itemIdx) => {
                totalItems++;
                if (item.checked) checkedItems++;
                return `
                                            <div class="shopping-item-row p-3 bg-white/40 rounded-xl hover:bg-white transition-all group/item ${item.checked ? 'opacity-60' : ''}">
                                                <div class="flex items-start gap-3">
                                                    <input type="checkbox" ${item.checked ? 'checked' : ''} 
                                                           onchange="toggleShopItem(${groupIdx}, ${itemIdx})"
                                                           class="mt-1 w-5 h-5 rounded-lg border-slate-200 text-blue-500 focus:ring-blue-500 transition-all cursor-pointer">
                                                    <div class="flex-1 min-w-0">
                                                        <div class="flex items-center gap-2">
                                                            <span class="text-sm font-bold text-slate-700 ${item.checked ? 'line-through' : ''}">${esc(item.text)}</span>
                                                            ${item.url ? `
                                                                <a href="${item.url}" target="_blank" class="text-blue-400 hover:text-blue-600 transition-colors">
                                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                                                    </svg>
                                                                </a>
                                                            ` : ''}
                                                        </div>
                                                        ${item.note ? `<p class="text-[10px] text-slate-400 font-medium mt-0.5">${esc(item.note)}</p>` : ''}
                                                    </div>
                                                </div>
                                            </div>
                                        `;
            }).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            const progress = document.getElementById('shopProgress');
            if (progress) progress.innerText = `${checkedItems}/${totalItems}`;
        }

        function toggleShopItem(groupIdx, itemIdx) {
            shopping[groupIdx].items[itemIdx].checked = !shopping[groupIdx].items[itemIdx].checked;
            if (window.navigator.vibrate) window.navigator.vibrate(20);
            renderShop();
        }

        function renderTodo() {
            const container = document.getElementById('todo');
            if (!container) return;
            container.innerHTML = `
                <div class="glass-card p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-black">âœ… å¾…è¾¦äº‹é …</h2>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Action Items</span>
                    </div>
                    <div class="space-y-3">
                        ${todos.map((item, idx) => `
                            <label class="flex items-center justify-between p-4 ${item.checked ? 'bg-green-50/30 border-green-100/50' : 'bg-white/40 border-white/50'} rounded-2xl border transition-all cursor-pointer hover:bg-white/60">
                                <span class="text-sm font-bold ${item.checked ? 'text-slate-400 line-through' : 'text-slate-700'}">${esc(item.text)}</span>
                                <input type="checkbox" ${item.checked ? 'checked' : ''} 
                                       onchange="toggleTodo(${idx})"
                                       class="w-6 h-6 rounded-full border-slate-200 text-green-500 focus:ring-green-500 transition-all cursor-pointer">
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function toggleTodo(idx) {
            todos[idx].checked = !todos[idx].checked;
            if (window.navigator.vibrate) window.navigator.vibrate(20);
            renderTodo();
        }

        // --- Final Execution ---
        document.addEventListener('DOMContentLoaded', () => {
            renderDay(currentDay);
            renderShop();
            renderTodo();
        });

        // Fallback if DOMContentLoaded already fired
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            renderDay(currentDay);
            renderShop();
            renderTodo();
        }
    </script>
</body>

</html>